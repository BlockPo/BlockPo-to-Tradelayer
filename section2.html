
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualización interactiva de datos geográficos &#8212; Maestría en Estadística Aplicada</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introducción a la visualización de datos con Python" href="section1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Maestría en Estadística Aplicada</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Visualización de Datos con R y Python Sección 1
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="section1.html">
   Introducción a la visualización de datos con Python
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Visualización interactiva de datos geográficos
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/section2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/section2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Visualización interactiva de datos geográficos
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduccion">
     Introducción
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapas-coropleticos">
     Mapas coropléticos
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ejercicio-45-creacion-de-un-mapa-coropletico">
       Ejercicio 45: Creación de un mapa coroplético
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ejercicio-46-ajustar-un-mapa-coropletico-mundial">
       Ejercicio 46: Ajustar un mapa coroplético mundial
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ejercicio-47-anadir-animacion-a-un-mapa-coropletico">
       Ejercicio 47: Añadir animación a un mapa coroplético
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapas-de-los-estados-de-ee-uu">
     Mapas de los estados de EE.UU
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ejercicio-48-creacion-de-un-mapa-coropletico-de-estados-unidos">
       Ejercicio 48: Creación de un mapa coroplético de Estados Unidos
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graficos-sobre-mapas-geograficos">
     Gráficos sobre mapas geográficos
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ejercicio-49-creacion-de-un-grafico-de-dispersion-en-un-mapa-geografico">
       Ejercicio 49: Creación de un gráfico de dispersión en un mapa geográfico
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ejercicio-50-creacion-de-un-grafico-de-burbujas-en-un-mapa-geografico">
       Ejercicio 50: Creación de un gráfico de burbujas en un mapa geográfico
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lineas-sobre-mapas-geograficos">
     Líneas sobre mapas geográficos
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creacion-de-graficos-de-lineas-en-un-mapa-geografico">
       51: Creación de gráficos de líneas en un mapa geográfico
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tarea-2-1">
     Tarea 2.1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modelo-predictivo-con-series-de-tiempo">
   Modelo predictivo con series de tiempo
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduccion-al-modelo-arima">
     Introducción al modelo ARIMA
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementacion-del-modelo-arima">
     Implementación del modelo ARIMA
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tarea-2-2">
     Tarea 2.2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#errores-comunes-al-crear-visualizaciones-interactivas">
   Errores comunes al crear visualizaciones interactivas
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Introducción
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#formato-e-interpretacion-de-datos">
     Formato e interpretación de datos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ejercicio-52-visualizacion-de-valores-atipicos-en-un-conjunto-de-datos-con-un-grafico-de-cajas">
     Ejercicio 52: Visualización de valores atípicos en un conjunto de datos con un gráfico de cajas
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ejercicio-53-como-tratar-los-valores-atipicos">
     Ejercicio 53: Cómo tratar los valores atípicos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ejercicio-54-tratamiento-de-los-valores-faltantes">
     Ejercicio 54: Tratamiento de los valores faltantes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tarea-2-3">
     Tarea 2.3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#importacion-y-cargue-de-datos-en-postgresql-usando-heroku">
   Importación y cargue de datos en PostgreSQL usando Heroku
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Introducción
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creacion-de-base-de-datos-heroku-postgres">
     Creación de base de datos
     <code class="docutils literal notranslate">
      <span class="pre">
       Heroku
      </span>
      <span class="pre">
       Postgres
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consultas-desde-python-a-heroku-postgres">
     Consultas desde Python a Heroku Postgres
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Tarea 2.3
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <h1>Tabla de contenido<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Visualización-interactiva-de-datos-geográficos" data-toc-modified-id="Visualización-interactiva-de-datos-geográficos-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Visualización interactiva de datos geográficos</a></span><ul class="toc-item"><li><span><a href="#Introducción" data-toc-modified-id="Introducción-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Introducción</a></span></li><li><span><a href="#Mapas-de-coropletas" data-toc-modified-id="Mapas-de-coropletas-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Mapas de coropletas</a></span><ul class="toc-item"><li><span><a href="#Ejercicio-45:-Creación-de-un-mapa-coroplético" data-toc-modified-id="Ejercicio-45:-Creación-de-un-mapa-coroplético-1.2.1"><span class="toc-item-num">1.2.1&nbsp;&nbsp;</span>Ejercicio 45: Creación de un mapa coroplético</a></span></li><li><span><a href="#Ejercicio-46:-Ajustar-un-mapa-coroplético-mundial" data-toc-modified-id="Ejercicio-46:-Ajustar-un-mapa-coroplético-mundial-1.2.2"><span class="toc-item-num">1.2.2&nbsp;&nbsp;</span>Ejercicio 46: Ajustar un mapa coroplético mundial</a></span></li><li><span><a href="#Ejercicio-47:-Añadir-animación-a-un-mapa-coroplético" data-toc-modified-id="Ejercicio-47:-Añadir-animación-a-un-mapa-coroplético-1.2.3"><span class="toc-item-num">1.2.3&nbsp;&nbsp;</span>Ejercicio 47: Añadir animación a un mapa coroplético</a></span></li></ul></li><li><span><a href="#Mapas-de-los-estados-de-EE.UU" data-toc-modified-id="Mapas-de-los-estados-de-EE.UU-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>Mapas de los estados de EE.UU</a></span><ul class="toc-item"><li><span><a href="#Ejercicio-48:-Creación-de-un-mapa-coroplético-de-Estados-Unidos" data-toc-modified-id="Ejercicio-48:-Creación-de-un-mapa-coroplético-de-Estados-Unidos-1.3.1"><span class="toc-item-num">1.3.1&nbsp;&nbsp;</span>Ejercicio 48: Creación de un mapa coroplético de Estados Unidos</a></span></li></ul></li><li><span><a href="#Gráficos-sobre-mapas-geográficos" data-toc-modified-id="Gráficos-sobre-mapas-geográficos-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>Gráficos sobre mapas geográficos</a></span><ul class="toc-item"><li><span><a href="#Ejercicio-49:-Creación-de-un-gráfico-de-dispersión-en-un-mapa-geográfico" data-toc-modified-id="Ejercicio-49:-Creación-de-un-gráfico-de-dispersión-en-un-mapa-geográfico-1.4.1"><span class="toc-item-num">1.4.1&nbsp;&nbsp;</span>Ejercicio 49: Creación de un gráfico de dispersión en un mapa geográfico</a></span></li><li><span><a href="#Ejercicio-50:-Creación-de-un-gráfico-de-burbujas-en-un-mapa-geográfico" data-toc-modified-id="Ejercicio-50:-Creación-de-un-gráfico-de-burbujas-en-un-mapa-geográfico-1.4.2"><span class="toc-item-num">1.4.2&nbsp;&nbsp;</span>Ejercicio 50: Creación de un gráfico de burbujas en un mapa geográfico</a></span></li></ul></li><li><span><a href="#Líneas-sobre-mapas-geográficos" data-toc-modified-id="Líneas-sobre-mapas-geográficos-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Líneas sobre mapas geográficos</a></span><ul class="toc-item"><li><span><a href="#51:-Creación-de-gráficos-de-líneas-en-un-mapa-geográfico" data-toc-modified-id="51:-Creación-de-gráficos-de-líneas-en-un-mapa-geográfico-1.5.1"><span class="toc-item-num">1.5.1&nbsp;&nbsp;</span>51: Creación de gráficos de líneas en un mapa geográfico</a></span></li></ul></li><li><span><a href="#Tarea-2.1" data-toc-modified-id="Tarea-2.1-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>Tarea 2.1</a></span></li></ul></li><li><span><a href="#Modelo-predictivo-con-series-de-tiempo" data-toc-modified-id="Modelo-predictivo-con-series-de-tiempo-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Modelo predictivo con series de tiempo</a></span><ul class="toc-item"><li><span><a href="#Introducción-al-modelo-ARIMA" data-toc-modified-id="Introducción-al-modelo-ARIMA-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>Introducción al modelo ARIMA</a></span></li><li><span><a href="#Implementación-del-modelo-ARIMA" data-toc-modified-id="Implementación-del-modelo-ARIMA-2.2"><span class="toc-item-num">2.2&nbsp;&nbsp;</span>Implementación del modelo ARIMA</a></span></li><li><span><a href="#Tarea-2.2" data-toc-modified-id="Tarea-2.2-2.3"><span class="toc-item-num">2.3&nbsp;&nbsp;</span>Tarea 2.2</a></span></li></ul></li><li><span><a href="#Errores-comunes-al-crear-visualizaciones-interactivas" data-toc-modified-id="Errores-comunes-al-crear-visualizaciones-interactivas-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Errores comunes al crear visualizaciones interactivas</a></span><ul class="toc-item"><li><span><a href="#Introducción" data-toc-modified-id="Introducción-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>Introducción</a></span></li><li><span><a href="#Formato-e-interpretación-de-datos" data-toc-modified-id="Formato-e-interpretación-de-datos-3.2"><span class="toc-item-num">3.2&nbsp;&nbsp;</span>Formato e interpretación de datos</a></span></li><li><span><a href="#Ejercicio-52:-Visualización-de-valores-atípicos-en-un-conjunto-de-datos-con-un-gráfico-de-cajas" data-toc-modified-id="Ejercicio-52:-Visualización-de-valores-atípicos-en-un-conjunto-de-datos-con-un-gráfico-de-cajas-3.3"><span class="toc-item-num">3.3&nbsp;&nbsp;</span>Ejercicio 52: Visualización de valores atípicos en un conjunto de datos con un gráfico de cajas</a></span></li><li><span><a href="#Ejercicio-53:-Cómo-tratar-los-valores-atípicos" data-toc-modified-id="Ejercicio-53:-Cómo-tratar-los-valores-atípicos-3.4"><span class="toc-item-num">3.4&nbsp;&nbsp;</span>Ejercicio 53: Cómo tratar los valores atípicos</a></span></li><li><span><a href="#Ejercicio-54:-Tratamiento-de-los-valores-faltantes" data-toc-modified-id="Ejercicio-54:-Tratamiento-de-los-valores-faltantes-3.5"><span class="toc-item-num">3.5&nbsp;&nbsp;</span>Ejercicio 54: Tratamiento de los valores faltantes</a></span></li><li><span><a href="#Tarea-2.3" data-toc-modified-id="Tarea-2.3-3.6"><span class="toc-item-num">3.6&nbsp;&nbsp;</span>Tarea 2.3</a></span></li></ul></li><li><span><a href="#Importación-y-cargue-de-datos-en-PostgreSQL-usando-Heroku" data-toc-modified-id="Importación-y-cargue-de-datos-en-PostgreSQL-usando-Heroku-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Importación y cargue de datos en PostgreSQL usando Heroku</a></span><ul class="toc-item"><li><span><a href="#Introducción" data-toc-modified-id="Introducción-4.1"><span class="toc-item-num">4.1&nbsp;&nbsp;</span>Introducción</a></span></li><li><span><a href="#Creación-de-base-de-datos-Heroku-Postgres" data-toc-modified-id="Creación-de-base-de-datos-Heroku-Postgres-4.2"><span class="toc-item-num">4.2&nbsp;&nbsp;</span>Creación de base de datos <code>Heroku Postgres</code></a></span></li><li><span><a href="#Consultas-desde-Python-a-Heroku-Postgres" data-toc-modified-id="Consultas-desde-Python-a-Heroku-Postgres-4.3"><span class="toc-item-num">4.3&nbsp;&nbsp;</span>Consultas desde Python a Heroku Postgres</a></span></li><li><span><a href="#Tarea-2.3" data-toc-modified-id="Tarea-2.3-4.4"><span class="toc-item-num">4.4&nbsp;&nbsp;</span>Tarea 2.3</a></span></li></ul></li></ul></div><div class="section" id="visualizacion-interactiva-de-datos-geograficos">
<h1>Visualización interactiva de datos geográficos<a class="headerlink" href="#visualizacion-interactiva-de-datos-geograficos" title="Permalink to this headline">¶</a></h1>
<p><strong>Objetivos</strong></p>
<ul class="simple">
<li><p>Utilizar mapas coropléticos para representar datos en distintas regiones geográficas</p></li>
<li><p>Generar mapas coropléticos interactivos, incluyendo mapas que representan países en el mundo y mapas que representan estados en EE.UU., haciendo cambios de diseño para añadir funcionalidad/estética, y añadiendo animaciones</p></li>
<li><p>Generar gráficos de dispersión interactivos en los mapas, incluidos los gráficos de dispersión que indican las geolocalizaciones de lugares de interés y gráficos de burbujas interactivos en mapas</p></li>
<li><p>Generar gráficos lineales interactivos en mapas, incluyendo aquellos que indiquen trayectorias en un mapa</p></li>
</ul>
<p>En este capítulo, aprenderemos a utilizar visualizaciones interactivas para representar datos en regiones geográficas.</p>
<div class="section" id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>La mayoría de los conjuntos de datos generados en el mundo actual incluyen algunas características que representan aspectos espaciales o aspectos geográficos. Por ejemplo, los usuarios de las plataformas de medios sociales se caracterizan por las diferentes partes del mundo en las que residen, las métricas de desarrollo mundial se se calculan para diferentes países del mundo, las rutas de transporte que abarcan diferentes lugares del planeta, etc. Es esencial aprender aprender formas sistemáticas de entender y presentar esa información de forma digerible y a la vez perspicaz.</p></li>
<li><p>Esta sección le ayudará a desarrollar esta capacidad proporcionando las herramientas necesarias para generar una variedad de gráficos que representen datos geográficos. Mientras que <code class="docutils literal notranslate"><span class="pre">altair</span></code> y <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> ofrecen interesantes posibilidades para visualizar datos geográficos datos geográficos, <code class="docutils literal notranslate"><span class="pre">plotly</span></code> es especialmente bueno para generar una variedad de gráficos geográficos que son fáciles de construir, depurar y personalizar. Por lo tanto, en este capítulo, utilizaremos plotly para demostrar la generación de diferentes clases de gráficos geográficos con múltiples conjuntos de datos disponibles públicamente de una variedad de contextos.</p></li>
</ul>
</div>
<div class="section" id="mapas-coropleticos">
<h2>Mapas coropléticos<a class="headerlink" href="#mapas-coropleticos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Un mapa coroplético es un mapa de una región con diferentes divisiones coloreadas para indicar el valor de una característica específica en esa división. Esta división puede ser un país, un estado, un distrito o cualquier otra zona bien documentada. Por ejemplo, se puede visualizar la población de un país en un mapa mundial, la población de un estado en un mapa de un país o el porcentaje de población con acceso a una tecnología con un mapa coropléjico.</p></li>
</ul>
<div class="section" id="ejercicio-45-creacion-de-un-mapa-coropletico">
<h3>Ejercicio 45: Creación de un mapa coroplético<a class="headerlink" href="#ejercicio-45-creacion-de-un-mapa-coropletico" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>En la primera visualización de esta sección, vamos a utilizar las estadísticas de uso de Internet publicadas en Our World in Data (<a class="reference external" href="https://ourworldindata.org/internet">https://ourworldindata.org/internet</a>) y presentar el porcentaje de la población que utiliza Internet en cada país desde 1990 hasta 2017. ¿Se ha fijado en la característica llamada Código en el conjunto de datos? Se trata de un código asignado a cada país por una norma llamada ISO 3166-1. Se utiliza ampliamente para que los desarrolladores de todo el mundo tengan una forma común de referirse y acceder a los nombres de los países en cualquier dato.</p></li>
<li><p>En este ejercicio, generaremos un mapa coroplético mundial utilizando el conjunto de datos Our World in Datos. Como el DataFrame contiene registros de varios años, primero vamos a subdividir los datos en un año específico, por ejemplo, 2016. A continuación, utilizaremos este subconjunto para generar un mapa mundial. Para ello, vamos a seguir los siguientes pasos</p></li>
</ul>
<ul class="simple">
<li><p>Importar los módulos de Python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lea los datos del archivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_usage_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/share-of-individuals-using-the-internet.csv&quot;</span>
<span class="n">internet_usage_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">internet_usage_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Hacer sub-conjuntos de datos de un año específico, ya que el DataFrame contiene registros de múltiples años</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_usage_2016</span> <span class="o">=</span> <span class="n">internet_usage_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Year==2016&quot;</span><span class="p">)</span>
<span class="n">internet_usage_2016</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Individuals using the Internet (% of population)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2016</td>
      <td>10.595726</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Albania</td>
      <td>ALB</td>
      <td>2016</td>
      <td>66.363445</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>2016</td>
      <td>42.945527</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Andorra</td>
      <td>AND</td>
      <td>2016</td>
      <td>97.930637</td>
    </tr>
    <tr>
      <th>107</th>
      <td>Angola</td>
      <td>AGO</td>
      <td>2016</td>
      <td>13.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Para los siguientes pasos, vamos a utilizar el módulo express (por su simplicidad) de <code class="docutils literal notranslate"><span class="pre">plotly</span></code> y utilizar la función <code class="docutils literal notranslate"><span class="pre">choropleth</span></code> del módulo. El primer argumento que se pasa a esta función es el DataFrame que queremos visualizar. Los siguientes parámetros:</p>
<ul>
<li><p><em>locations</em>: Se establece como el nombre de la columna del DataFrame que contiene los códigos de país ISO 3166</p></li>
<li><p><em>color</em>: Se establece el nombre de la columna que contiene la característica numérica con la que se va a colorear el mapa</p></li>
<li><p><em>hover_name</em>: Se establece el nombre de la columna que contiene la característica que se mostrará al pasar el ratón por encima del mapa</p></li>
<li><p><em>color_continuous_scale</em>: Esto se establece en un esquema de color, como: Blues | Reds | Greens | px.colors.sequential.Plasma.</p></li>
</ul>
</li>
<li><p>Genera un mapa coroplético mundial interactivo utilizando la función choropleth de la biblioteca <code class="docutils literal notranslate"><span class="pre">plotly</span></code></p></li>
<li><p>Para visualizarlo de forma dinámica en su <code class="docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">Notebook</span></code> utlice solamente <code class="docutils literal notranslate"><span class="pre">fig.show()</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_2016</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="c1"># colunm containing ISO 3166 country codes</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information</span>
                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_15_0.svg" src="_images/section2_15_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Observemos el gráfico con atención y veamos si las observaciones coinciden con nuestros conocimientos generales. Como era de esperar, el uso de Internet en el mundo occidental es mayor que en que en el este.</p></li>
<li><p>Es interesante ver en la Figura que un mayor porcentaje de la población (<span class="math notranslate nohighlight">\(\approx91,6\)</span>) en Australia y Canadá tiene acceso a Internet en comparación con Estados Unidos y la mayoría de los países europeos (<span class="math notranslate nohighlight">\(\approx\)</span>59,5).</p></li>
</ul>
</div>
<div class="section" id="ejercicio-46-ajustar-un-mapa-coropletico-mundial">
<h3>Ejercicio 46: Ajustar un mapa coroplético mundial<a class="headerlink" href="#ejercicio-46-ajustar-un-mapa-coropletico-mundial" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>En este ejercicio, haremos algunos cambios sencillos en el diseño del mapa coropleto, como cambiar la proyección del mapa de <em>flat</em> a <em>natural earth</em>, hacer zoom en una región específica, añadir texto al mapa utilizando la función <code class="docutils literal notranslate"><span class="pre">update_layout</span></code>, y añadir una función de rotación.</p></li>
</ul>
<ul class="simple">
<li><p>Importar los módulos de Python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lea los datos del archivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_usage_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/share-of-individuals-using-the-internet.csv&quot;</span>
<span class="n">internet_usage_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">internet_usage_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Hacer sub-conjuntos de datos de un año específico, ya que el DataFrame contiene registros de múltiples años</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_usage_2016</span> <span class="o">=</span> <span class="n">internet_usage_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Year==2016&quot;</span><span class="p">)</span>
<span class="n">internet_usage_2016</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Individuals using the Internet (% of population)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2016</td>
      <td>10.595726</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Albania</td>
      <td>ALB</td>
      <td>2016</td>
      <td>66.363445</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>2016</td>
      <td>42.945527</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Andorra</td>
      <td>AND</td>
      <td>2016</td>
      <td>97.930637</td>
    </tr>
    <tr>
      <th>107</th>
      <td>Angola</td>
      <td>AGO</td>
      <td>2016</td>
      <td>13.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Añade el texto del título al mapa coropleto estableciendo el parámetro <code class="docutils literal notranslate"><span class="pre">title_text</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_2016</span><span class="p">,</span>
                    <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information </span>
                    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet usage across the world (% population)&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_26_0.svg" src="_images/section2_26_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Digamos que sólo nos interesa ver el uso de Internet en el continente de Sur América. Establezca <code class="docutils literal notranslate"><span class="pre">geo_scope</span></code> a <em>south america</em> en la función <code class="docutils literal notranslate"><span class="pre">update_layout</span></code> para hacer zoom en la región de asia. Podemos hacerlo rápidamente con el siguiente código</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_2016</span><span class="p">,</span>
                    <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information </span>
                    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Uso de Internet en todo Sur América (</span><span class="si">% d</span><span class="s1">e población) - 2016&#39;</span><span class="p">,</span>
    <span class="n">geo_scope</span> <span class="o">=</span> <span class="s1">&#39;south america&#39;</span> <span class="c1"># can be set to north america | south america | africa | asia | europe | usa</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_28_0.svg" src="_images/section2_28_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_2016</span><span class="p">,</span>
                    <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information </span>
                    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet usage across the Asian Continent (% population) - 2016&#39;</span><span class="p">,</span>
    <span class="n">geo_scope</span> <span class="o">=</span> <span class="s1">&#39;asia&#39;</span> <span class="c1"># can be set to north america | south america | africa | asia | europe | usa</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_29_0.svg" src="_images/section2_29_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Establece <em>projection type</em> como <em>natural earth</em>. La gráfica podría rotarse como un globo terráqueo real</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_2016</span><span class="p">,</span>
                    <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information</span>
                    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet usage across the world (% population)&#39;</span><span class="p">,</span>
    <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_31_0.svg" src="_images/section2_31_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Prueba a arrastrar el mapa ahora. La rotación le da al gráfico un toque mucho más realista. <code class="docutils literal notranslate"><span class="pre">plotly</span></code> ofrece muchas opciones de este tipo para ajustar las visualizaciones. Para experimentar con otros estilos de proyección aparte de los que hemos visto en nuestros ejemplos, visite la documentación oficial de documentación de <code class="docutils literal notranslate"><span class="pre">plotly</span></code> aquí: <a class="reference external" href="https://plot.ly/python/reference/#layout-geo-">https://plot.ly/python/reference/#layout-geo-</a> proyección.</p></li>
</ul>
</div>
<div class="section" id="ejercicio-47-anadir-animacion-a-un-mapa-coropletico">
<h3>Ejercicio 47: Añadir animación a un mapa coroplético<a class="headerlink" href="#ejercicio-47-anadir-animacion-a-un-mapa-coropletico" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>En este ejercicio, animaremos un mapa coroplético mundial. Primero, elegiremos una columna. A continuación, añadiremos un componente deslizante al mapa para ver los registros en diferentes puntos temporales</p></li>
</ul>
<ul class="simple">
<li><p>Importar los módulos de Python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lea los datos del archivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_usage_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/share-of-individuals-using-the-internet.csv&quot;</span>
<span class="n">internet_usage_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">internet_usage_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Añade una animación a la columna <em>year</em> utilizando <code class="docutils literal notranslate"><span class="pre">animation_frame=year</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_df</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># lifeExp is a column of gapminder</span>
                    <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to add to hover information</span>
                    <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="c1"># column on which to animate</span>
                    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
 
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet usage across the world (% population)&#39;</span><span class="p">,</span>
    <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_40_0.svg" src="_images/section2_40_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Observe que el primer argumento de nuestra función de coropleta es el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">internet_usage_df</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, que contiene registros para todos los años entre 1970- 2017, y no <code class="docutils literal notranslate"><span class="pre">internet_usage_2016</span></code>, que habíamos utilizado hasta ahora. Si Si utilizáramos el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">internet_usage_2016</span></code>, obtendríamos un gráfico estático sin deslizante, ya que no habría nada que animar con registros de un solo año. La funcionalidad de la animación y el deslizador es una forma sencilla de ver cómo ha crecido el uso de Internet en diferentes países del mundo a lo largo de los años.</p></li>
<li><p>Sin embargo, ¡hay algo en el deslizador que resulta curioso! Los años en el deslizador no están en el orden correcto, comienza con 1990, luego llega hasta 2015, y luego vuelve a 1970 y así sucesivamente. La forma más fácil de solucionar este problema es ordenar el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> por tiempo (la variable <strong>Year</strong>).</p></li>
</ul>
<ul class="simple">
<li><p>Ordene el conjunto de datos por <strong>Year</strong> utilizando el siguiente código</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_usage_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">internet_usage_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Individuals using the Internet (% of population)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5347</th>
      <td>Syrian Arab Republic</td>
      <td>NaN</td>
      <td>1960</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>718</th>
      <td>Burundi</td>
      <td>BDI</td>
      <td>1960</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5493</th>
      <td>Togo</td>
      <td>TGO</td>
      <td>1960</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>572</th>
      <td>Botswana</td>
      <td>BWA</td>
      <td>1960</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3414</th>
      <td>Maldives</td>
      <td>MDV</td>
      <td>1960</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Vuelva a generar el gráfico animado ahora que la clasificación está hecha</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">internet_usage_df</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Individuals using the Internet (</span><span class="si">% o</span><span class="s2">f population)&quot;</span><span class="p">,</span> <span class="c1"># lifeExp is a column of gapminder</span>
                    <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to add to hover information</span>
                    <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="c1"># column on which to animate</span>
                    <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
 
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet usage across the world (% population)&#39;</span><span class="p">,</span>
    <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_45_0.svg" src="_images/section2_45_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Podemos ver que hubo definitivamente un aumento en el uso de Internet entre 1992 y 2010. Hay un punto más que debe ser abordado antes de cerrar nuestra discusión sobre mapas coropléticos mundiales. En su trabajo, es posible que se encuentre con conjuntos de datos que serían interesantes de visualizar en un mapa geográfico pero que no tienen una columna que indique su código ISO 3166-1. En estos casos, puede descargar los códigos de los países desde el sitio web oficial de la ISO: <a class="reference external" href="https://www.iban.com/country-codes">https://www.iban.com/country-codes</a>.</p></li>
</ul>
<ul class="simple">
<li><p>Podrá ver el conjunto de datos de códigos de países utilizando el siguiente código</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">country_codes_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/country_codes.tsv&quot;</span>
<span class="n">country_codes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">country_codes_url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">country_codes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Alpha-2 code</th>
      <th>Alpha-3 code</th>
      <th>Numeric</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>AF</td>
      <td>AFG</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albania</td>
      <td>AL</td>
      <td>ALB</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Algeria</td>
      <td>DZ</td>
      <td>DZA</td>
      <td>12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>American Samoa</td>
      <td>AS</td>
      <td>ASM</td>
      <td>16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Andorra</td>
      <td>AD</td>
      <td>AND</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="mapas-de-los-estados-de-ee-uu">
<h2>Mapas de los estados de EE.UU<a class="headerlink" href="#mapas-de-los-estados-de-ee-uu" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Aunque el objetivo de muchas visualizaciones es comparar y contrastar características específicas entre países, a menudo también hay contextos en los que necesitamos analizar características entre regiones más pequeñas, como los estados dentro de un país. Para generar mapas coropléticos para los estados de EE.UU. utilizaremos los datos de población por estados que están disponibles en el sitio web del censo de EE.UU. <a class="reference external" href="https://www.census.gov/newsroom/press-kits/2018/pop-estimates-national-state.html">https://www.census.gov/newsroom/press-kits/2018/pop-estimates-national-state.html</a></p></li>
</ul>
<div class="section" id="ejercicio-48-creacion-de-un-mapa-coropletico-de-estados-unidos">
<h3>Ejercicio 48: Creación de un mapa coroplético de Estados Unidos<a class="headerlink" href="#ejercicio-48-creacion-de-un-mapa-coropletico-de-estados-unidos" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>En este ejercicio, utilizaremos el conjunto de datos de población de los Estados Unidos. Vamos a modificar el conjunto de datos y lo utilizaremos para trazar un mapa de coroplético de todo el estado. A continuación, cambiaremos el diseño de este mapa para mostrar la población de EE.UU. a través de los estados</p></li>
</ul>
<ul class="simple">
<li><p>Importar el módulo de Python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Leer el conjunto de datos de la URL</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_population_url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/us_state_population.tsv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">us_population_url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>Code</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>AL</td>
      <td>4785448</td>
      <td>4798834</td>
      <td>4815564</td>
      <td>4830460</td>
      <td>4842481</td>
      <td>4853160</td>
      <td>4864745</td>
      <td>4875120</td>
      <td>4887871</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>AK</td>
      <td>713906</td>
      <td>722038</td>
      <td>730399</td>
      <td>737045</td>
      <td>736307</td>
      <td>737547</td>
      <td>741504</td>
      <td>739786</td>
      <td>737438</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>AZ</td>
      <td>6407774</td>
      <td>6473497</td>
      <td>6556629</td>
      <td>6634999</td>
      <td>6733840</td>
      <td>6833596</td>
      <td>6945452</td>
      <td>7048876</td>
      <td>7171646</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>AR</td>
      <td>2921978</td>
      <td>2940407</td>
      <td>2952109</td>
      <td>2959549</td>
      <td>2967726</td>
      <td>2978407</td>
      <td>2990410</td>
      <td>3002997</td>
      <td>3013825</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>CA</td>
      <td>37320903</td>
      <td>37641823</td>
      <td>37960782</td>
      <td>38280824</td>
      <td>38625139</td>
      <td>38953142</td>
      <td>39209127</td>
      <td>39399349</td>
      <td>39557045</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Es bueno que este conjunto de datos también tenga los códigos estatales disponibles en la función Código. Sin embargo, los datos no están en el formato que querríamos: están en el formato ancho y necesitamos que sea largo</p></li>
<li><p>Utilice la función <code class="docutils literal notranslate"><span class="pre">melt</span></code> para convertir los datos al formato deseado</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Code&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Population&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>Code</th>
      <th>Year</th>
      <th>Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>AL</td>
      <td>2010</td>
      <td>4785448</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>AK</td>
      <td>2010</td>
      <td>713906</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>AZ</td>
      <td>2010</td>
      <td>6407774</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>AR</td>
      <td>2010</td>
      <td>2921978</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>CA</td>
      <td>2010</td>
      <td>37320903</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Una vez que sepa cómo generar un mapa coroplético de los países del mundo, un mapa coroplético de los estados de EE.UU. es bastante sencillo. A diferencia del caso de generar un mapa coroplético mundial en el que utilizamos el módulo <code class="docutils literal notranslate"><span class="pre">plotly</span></code> express utilizaremos el módulo <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code> para generar el mapa coroplético para los estados en los Estados Unidos</p></li>
<li><p>Importar el módulo graph_objects</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Inicialice la figura con la función <code class="docutils literal notranslate"><span class="pre">Figure</span></code> en <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code>. Específicamente, el argumento de datos debe ser una instancia de la clase <code class="docutils literal notranslate"><span class="pre">Choropleth</span></code> con los siguientes parámetros</p>
<ul>
<li><p><strong>locations</strong>: Se establece en la columna del <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contiene los códigos de los nombres de los estados. los códigos de los nombres</p></li>
<li><p><strong>z</strong>: Se establece en la columna que contiene la característica numérica con la que el mapa debe ser codificado por colores</p></li>
<li><p><strong>locationmode</strong>: Este se establece como Estados Unidos.</p></li>
<li><p><strong>colorscale</strong>: Esto se establece en un esquema de colores, como <strong>Blues | Reds | Greens</strong>. Para más opciones, consulte la documentación oficial de <code class="docutils literal notranslate"><span class="pre">plotly</span></code>: <a class="reference external" href="https://plot.ly/python/referencia/">https://plot.ly/python/referencia/</a>.</p></li>
<li><p><strong>colorbar_title</strong>: Esto se establece en el título de la barra de color de la derecha, indicando la correspondencia de los valores de color y característica.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize the figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Choropleth</span><span class="p">(</span>
        <span class="n">locations</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Code&#39;</span><span class="p">],</span> <span class="c1"># Code for US states</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="c1"># Data to be color-coded</span>
        <span class="n">locationmode</span> <span class="o">=</span> <span class="s1">&#39;USA-states&#39;</span><span class="p">,</span> <span class="c1"># set of locations match entries in &#39;locations&#39;</span>
        <span class="n">colorscale</span> <span class="o">=</span> <span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;Population&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Realice cambios en el diseño con <code class="docutils literal notranslate"><span class="pre">update_layout()</span></code> establezca <code class="docutils literal notranslate"><span class="pre">title_text</span></code> y <code class="docutils literal notranslate"><span class="pre">geo_scope</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update layout</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;US Population across states&#39;</span><span class="p">,</span>
    <span class="n">geo_scope</span><span class="o">=</span><span class="s1">&#39;usa&#39;</span><span class="p">,</span> <span class="c1"># limit map scope to USA</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_64_0.svg" src="_images/section2_64_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Los mapas coropléticos son una forma eficaz de visualizar estadísticas agregadas en las divisiones de una región geográfica. Se pueden utilizar dos módulos de <code class="docutils literal notranslate"><span class="pre">plotly</span></code> express y <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code> para generar mapas coropléticos interactivos. Los módulos mapean registros de de divisiones, como países y estados, a ubicaciones en mapas geográficos utilizando un sistema de nombres de códigos estandarizados de países y estados</p></li>
</ul>
</div>
</div>
<div class="section" id="graficos-sobre-mapas-geograficos">
<h2>Gráficos sobre mapas geográficos<a class="headerlink" href="#graficos-sobre-mapas-geograficos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Mientras que los gráficos anteriores eran excelentes para visualizar tendencias más globales como países o estados, ¿qué pasa si queremos representar características en regiones más pequeñas, digamos dentro de los estados individuales? En esta sección, aprenderá a dibujar gráficos de dispersión y gráficos de burbujas en los mapas.</p></li>
</ul>
<div class="section" id="ejercicio-49-creacion-de-un-grafico-de-dispersion-en-un-mapa-geografico">
<h3>Ejercicio 49: Creación de un gráfico de dispersión en un mapa geográfico<a class="headerlink" href="#ejercicio-49-creacion-de-un-grafico-de-dispersion-en-un-mapa-geografico" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Vamos a trazar las ubicaciones de las tiendas <strong>Walmart</strong> en un mapa de los Estados Unidos. Este conjunto de datos está disponible públicamente en: <a class="reference external" href="https://github.com/plotly/datasets/">https://github.com/plotly/datasets/</a> sitio web de <code class="docutils literal notranslate"><span class="pre">plotly</span></code>. En este ejercicio, utilizaremos el conjunto de datos de aperturas de tiendas <strong>Walmart</strong> de 1962 a 2006.</p></li>
<li><p>Para crear un gráfico de dispersión a partir de este conjunto de datos, utilizaremos el módulo <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code>. Encontraremos una ubicación de interés en el mapa y asignaremos longitudes y latitudes en ese mapa y averiguaremos el número de aperturas de tiendas <strong>Walmart</strong> para diferentes partes de los Estados Unidos.</p></li>
</ul>
<ul class="simple">
<li><p>Importar módulos de Python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lee los datos de la URL</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">walmart_locations_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/1962_2006_walmart_store_openings.csv&quot;</span>
<span class="n">walmart_loc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">walmart_locations_url</span><span class="p">)</span>
<span class="n">walmart_loc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>storenum</th>
      <th>OPENDATE</th>
      <th>date_super</th>
      <th>conversion</th>
      <th>st</th>
      <th>county</th>
      <th>STREETADDR</th>
      <th>STRCITY</th>
      <th>STRSTATE</th>
      <th>ZIPCODE</th>
      <th>type_store</th>
      <th>LAT</th>
      <th>LON</th>
      <th>MONTH</th>
      <th>DAY</th>
      <th>YEAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>7/1/62</td>
      <td>3/1/97</td>
      <td>1.0</td>
      <td>5</td>
      <td>7</td>
      <td>2110 WEST WALNUT</td>
      <td>Rogers</td>
      <td>AR</td>
      <td>72756</td>
      <td>Supercenter</td>
      <td>36.342235</td>
      <td>-94.07141</td>
      <td>7</td>
      <td>1</td>
      <td>1962</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>8/1/64</td>
      <td>3/1/96</td>
      <td>1.0</td>
      <td>5</td>
      <td>9</td>
      <td>1417 HWY 62/65 N</td>
      <td>Harrison</td>
      <td>AR</td>
      <td>72601</td>
      <td>Supercenter</td>
      <td>36.236984</td>
      <td>-93.09345</td>
      <td>8</td>
      <td>1</td>
      <td>1964</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>8/1/65</td>
      <td>3/1/02</td>
      <td>1.0</td>
      <td>5</td>
      <td>7</td>
      <td>2901 HWY 412 EAST</td>
      <td>Siloam Springs</td>
      <td>AR</td>
      <td>72761</td>
      <td>Supercenter</td>
      <td>36.179905</td>
      <td>-94.50208</td>
      <td>8</td>
      <td>1</td>
      <td>1965</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>10/1/67</td>
      <td>3/1/93</td>
      <td>1.0</td>
      <td>5</td>
      <td>29</td>
      <td>1621 NORTH BUSINESS 9</td>
      <td>Morrilton</td>
      <td>AR</td>
      <td>72110</td>
      <td>Supercenter</td>
      <td>35.156491</td>
      <td>-92.75858</td>
      <td>10</td>
      <td>1</td>
      <td>1967</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>10/1/67</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5</td>
      <td>119</td>
      <td>3801 CAMP ROBINSON RD.</td>
      <td>North Little Rock</td>
      <td>AR</td>
      <td>72118</td>
      <td>Wal-Mart</td>
      <td>34.813269</td>
      <td>-92.30229</td>
      <td>10</td>
      <td>1</td>
      <td>1967</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Volveremos a utilizar el módulo <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code> para generar nuestro gráfico de dispersión en el mapa de Estados Unidos. En cuanto al mapa de coropletas, utilizaremos la función <code class="docutils literal notranslate"><span class="pre">Figure</span></code> de <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code> y la función <code class="docutils literal notranslate"><span class="pre">update_layout()</span></code>. Sin embargo, esta vez asignaremos una instancia de la clase <code class="docutils literal notranslate"><span class="pre">Scattergeo</span></code> como argumento de <code class="docutils literal notranslate"><span class="pre">Figure()</span></code>. Pasaremos las longitudes y latitudes de nuestras localizaciones de interés utilizando los parámetros <code class="docutils literal notranslate"><span class="pre">lon</span></code> y <code class="docutils literal notranslate"><span class="pre">lat</span></code></p></li>
</ul>
<ul class="simple">
<li><p>Trazar el gráfico de dispersión utilizando la función <code class="docutils literal notranslate"><span class="pre">update_layout</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scattergeo</span><span class="p">(</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">walmart_loc_df</span><span class="p">[</span><span class="s1">&#39;LON&#39;</span><span class="p">],</span> <span class="c1"># column containing longitude information of the locations to plot</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">walmart_loc_df</span><span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">],</span> <span class="c1"># column containing latitude information of the locations to plot</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">walmart_loc_df</span><span class="p">[</span><span class="s1">&#39;STREETADDR&#39;</span><span class="p">],</span> <span class="c1"># column containing value to be displayed on hovering over the map</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span> <span class="c1"># a marker for each location</span>
<span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Walmart stores across world&#39;</span><span class="p">,</span>
    <span class="n">geo_scope</span><span class="o">=</span><span class="s1">&#39;usa&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_76_0.svg" src="_images/section2_76_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Una observación sorprendente es que Walmart es mucho más prominente en el este de los EE.UU. que en el oeste</p></li>
</ul>
</div>
<div class="section" id="ejercicio-50-creacion-de-un-grafico-de-burbujas-en-un-mapa-geografico">
<h3>Ejercicio 50: Creación de un gráfico de burbujas en un mapa geográfico<a class="headerlink" href="#ejercicio-50-creacion-de-un-grafico-de-burbujas-en-un-mapa-geografico" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Dado que la parte oriental del mapa de EE.UU. parece estar muy densamente poblada de tiendas <strong>Walmart</strong>, podría ser una buena idea mostrar una característica agregada, como el recuento de tiendas <strong>Walmart</strong> en los diferentes estados. Los gráficos de burbujas están diseñados exactamente para este tipo de visualización. En el contexto actual de la visualización de datos geográficos, los gráficos de burbujas son gráficos con tantas burbujas como regiones de interés, en los que el tamaño de las burbujas depende del valor que indiquen, cuanto mayor sea el valor, mayor será la burbuja</p></li>
<li><p>En este ejercicio, utilizaremos el conjunto de datos de aperturas de tiendas <strong>Walmart</strong> de 1962 a 2006 y generar un gráfico de burbujas para ver el número de tiendas <strong>Walmart</strong> en los diferentes estados de los Estados Unidos. A continuación, veremos otro contexto y generaremos un gráfico de burbujas utilizando el conjunto de datos Internet_usage para averiguar el número de usuarios de Internet en todo el mundo. También animaremos el gráfico de burbujas para mostrar el aumento del número de usuarios de Internet en todo el mundo</p></li>
</ul>
<ul class="simple">
<li><p>Importar módulos de Python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lee los datos de la URL</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">walmart_locations_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/1962_2006_walmart_store_openings.csv&quot;</span>
<span class="n">walmart_loc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">walmart_locations_url</span><span class="p">)</span>
<span class="n">walmart_loc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>storenum</th>
      <th>OPENDATE</th>
      <th>date_super</th>
      <th>conversion</th>
      <th>st</th>
      <th>county</th>
      <th>STREETADDR</th>
      <th>STRCITY</th>
      <th>STRSTATE</th>
      <th>ZIPCODE</th>
      <th>type_store</th>
      <th>LAT</th>
      <th>LON</th>
      <th>MONTH</th>
      <th>DAY</th>
      <th>YEAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>7/1/62</td>
      <td>3/1/97</td>
      <td>1.0</td>
      <td>5</td>
      <td>7</td>
      <td>2110 WEST WALNUT</td>
      <td>Rogers</td>
      <td>AR</td>
      <td>72756</td>
      <td>Supercenter</td>
      <td>36.342235</td>
      <td>-94.07141</td>
      <td>7</td>
      <td>1</td>
      <td>1962</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>8/1/64</td>
      <td>3/1/96</td>
      <td>1.0</td>
      <td>5</td>
      <td>9</td>
      <td>1417 HWY 62/65 N</td>
      <td>Harrison</td>
      <td>AR</td>
      <td>72601</td>
      <td>Supercenter</td>
      <td>36.236984</td>
      <td>-93.09345</td>
      <td>8</td>
      <td>1</td>
      <td>1964</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>8/1/65</td>
      <td>3/1/02</td>
      <td>1.0</td>
      <td>5</td>
      <td>7</td>
      <td>2901 HWY 412 EAST</td>
      <td>Siloam Springs</td>
      <td>AR</td>
      <td>72761</td>
      <td>Supercenter</td>
      <td>36.179905</td>
      <td>-94.50208</td>
      <td>8</td>
      <td>1</td>
      <td>1965</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>10/1/67</td>
      <td>3/1/93</td>
      <td>1.0</td>
      <td>5</td>
      <td>29</td>
      <td>1621 NORTH BUSINESS 9</td>
      <td>Morrilton</td>
      <td>AR</td>
      <td>72110</td>
      <td>Supercenter</td>
      <td>35.156491</td>
      <td>-92.75858</td>
      <td>10</td>
      <td>1</td>
      <td>1967</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>10/1/67</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5</td>
      <td>119</td>
      <td>3801 CAMP ROBINSON RD.</td>
      <td>North Little Rock</td>
      <td>AR</td>
      <td>72118</td>
      <td>Wal-Mart</td>
      <td>34.813269</td>
      <td>-92.30229</td>
      <td>10</td>
      <td>1</td>
      <td>1967</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Utilice la función <code class="docutils literal notranslate"><span class="pre">groupby</span></code> para calcular el número de tiendas Walmart por estado</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">walmart_stores_by_state</span> <span class="o">=</span> <span class="n">walmart_loc_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;STRSTATE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s1">&#39;storenum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;storenum&#39;</span><span class="p">:</span><span class="s1">&#39;NUM_STORES&#39;</span><span class="p">})</span>
<span class="n">walmart_stores_by_state</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STRSTATE</th>
      <th>NUM_STORES</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AR</td>
      <td>81</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AZ</td>
      <td>55</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CA</td>
      <td>159</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CO</td>
      <td>56</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Para generar los gráficos de burbujas, utilizaremos el módulo <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code> y la función <code class="docutils literal notranslate"><span class="pre">scatter_geo</span></code>. Obsérvese que el parámetro <code class="docutils literal notranslate"><span class="pre">locations</span></code> se establece con el nombre de la columna que contiene los códigos de estado, y el parámetro <code class="docutils literal notranslate"><span class="pre">size</span></code> se ajusta a la función función <code class="docutils literal notranslate"><span class="pre">NUM_STORES</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">walmart_stores_by_state</span><span class="p">,</span>
                     <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;STRSTATE&quot;</span><span class="p">,</span> <span class="c1"># name of column which contains state codes</span>
                     <span class="n">size</span><span class="o">=</span><span class="s2">&quot;NUM_STORES&quot;</span><span class="p">,</span> <span class="c1"># name of column which contains aggregate value to visualize</span>
                     <span class="n">locationmode</span> <span class="o">=</span> <span class="s1">&#39;USA-states&#39;</span><span class="p">,</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;STRSTATE&quot;</span><span class="p">,</span>
                     <span class="n">size_max</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Walmart stores across states in the US&#39;</span><span class="p">,</span>
    <span class="c1"># limit plot scope to USA</span>
    <span class="n">geo_scope</span><span class="o">=</span><span class="s1">&#39;usa&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_87_0.svg" src="_images/section2_87_0.svg" /></div>
</div>
<ul class="simple">
<li><p>¿Se te ocurre algún otro contexto en el que un gráfico de burbujas pueda ser útil para visualización? ¿Qué tal si revisamos los datos de uso de Internet (sobre los porcentajes de la población que utiliza Internet en cada país) para generar un gráfico de burbujas a nivel mundial?</p></li>
<li><p>Resulta que el recuento de individuos que utilizan Internet en cada país también está disponible en el mismo recurso (Our World in Data: <a class="reference external" href="https://ourworldindata">https://ourworldindata</a>. org/internet) que hemos utilizado para recoger nuestros datos anteriores.</p></li>
</ul>
<ul class="simple">
<li><p>Utilice el siguiente código para leer los datos de los usuarios de Internet por país conjunto de datos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">internet_users_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/number-of-internet-users-by-country.csv&quot;</span>
<span class="n">internet_users_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">internet_users_url</span><span class="p">)</span>
<span class="n">internet_users_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Number of internet users (users)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1990</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2001</td>
      <td>990</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2002</td>
      <td>1003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2003</td>
      <td>20272</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2004</td>
      <td>25520</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Ordenar el DataFrame por la característica <em>Year</em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">internet_users_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">internet_users_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Number of internet users (users)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1990</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1257</th>
      <td>Eritrea</td>
      <td>ERI</td>
      <td>1990</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1236</th>
      <td>Equatorial Guinea</td>
      <td>GNQ</td>
      <td>1990</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4016</th>
      <td>Timor</td>
      <td>TLS</td>
      <td>1990</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>El Salvador</td>
      <td>SLV</td>
      <td>1990</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Traza el número de usuarios que utilizan Internet en todo el mundo en 2016</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">internet_users_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Year==2016&quot;</span><span class="p">),</span>
                     <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="c1"># name of column indicating country-codes</span>
                     <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Number of internet users (users)&quot;</span><span class="p">,</span> <span class="c1"># name of column by which to size the bubble</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># name of column to be displayed while hovering over the map</span>
                     <span class="n">size_max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="c1"># parameter to scale all bubble sizes</span>
                     <span class="n">color_continuous_scale</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">)</span>
 
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet users across the world - 2016&#39;</span><span class="p">,</span> <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_94_0.svg" src="_images/section2_94_0.svg" /></div>
</div>
<ul class="simple">
<li><p>¿Notas que el mayor número de usuarios procede de India y China? Como sabemos por nuestro conjunto de datos anterior que el porcentaje de la población que utiliza Internet en estos países es bajo, este gran grupo de usuarios puede atribuirse a la población de estos países.</p></li>
<li><p>Anima el gráfico de burbujas para mostrar el aumento del número de usuarios de Internet a lo largo de los años utilizando el parámetro <code class="docutils literal notranslate"><span class="pre">animation_frame</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">internet_users_df</span><span class="p">,</span>
                     <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="c1"># name of column indicating country-codes</span>
                     <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Number of internet users (users)&quot;</span><span class="p">,</span> <span class="c1"># name of column by which to size the bubble</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># name of column to be displayed while hovering over the map</span>
                     <span class="n">size_max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="c1"># parameter to scale all bubble size</span>
                     <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span>
                    <span class="p">)</span>
 
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Internet users across the world&#39;</span><span class="p">,</span> <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_96_0.svg" src="_images/section2_96_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Podemos ver en los dos gráficos anteriores cómo el número de usuarios de Internet aumentó entre 2001 y 2016 en Estados Unidos. Los gráficos de dispersión en los mapas pueden utilizarse para mostrar ubicaciones específicas de interés en los mapas geográficos, mientras que los mapas de burbujas son una buena forma de presentar los datos de recuento a través de diferentes fuentes.</p></li>
</ul>
</div>
</div>
<div class="section" id="lineas-sobre-mapas-geograficos">
<h2>Líneas sobre mapas geográficos<a class="headerlink" href="#lineas-sobre-mapas-geograficos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Los gráficos de líneas representados en mapas son otra clase importante de visualización de datos geográficos. Para esta sección, utilizaremos los datos de aeropuertos y vuelos del conjunto de datos de retrasos y cancelaciones de vuelos de 2015 publicado por el <strong>U.S. Department of Transportation’s (DOT). Bureau of Transportation Statistics</strong></p></li>
<li><p>Como el conjunto de datos es enorme, solo incluiremos los datos de todos los vuelos con retrasos de las aerolíneas el 1 de enero de 2015.</p></li>
<li><p><strong>airports.csv</strong>: Contiene atributos de ubicación como la información de latitud y longitud para todos los aeropuertos</p></li>
<li><p><strong>new_year_day_2015_delayed_flights.csv</strong>: Contiene detalles de los vuelos, como los números de vuelo, aeropuertos de origen y destino de todos los vuelos del subconjunto seleccionado.</p></li>
</ul>
<div class="section" id="creacion-de-graficos-de-lineas-en-un-mapa-geografico">
<h3>51: Creación de gráficos de líneas en un mapa geográfico<a class="headerlink" href="#creacion-de-graficos-de-lineas-en-un-mapa-geografico" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>En este ejercicio, utilizaremos el conjunto de datos de los aeropuertos y generaremos primero un gráfico de dispersión para averiguar la ubicación de todos los aeropuertos de <strong>Estados Unidos</strong>. A continuación, combinaremos los dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> (<strong>flights</strong> y <strong>airport_record</strong>) para obtener la longitud y latitud de los de los aeropuertos de origen de todos los vuelos y dibujaremos líneas desde el aeropuerto de origen hasta el aeropuerto de destino de cada vuelo utilizando esta fusión.</p></li>
</ul>
<ul class="simple">
<li><p>Cargue primero el conjunto de datos de los aeropuertos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">us_airports_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/airports.csv&quot;</span>
<span class="n">us_airports_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">us_airports_url</span><span class="p">)</span>
<span class="n">us_airports_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IATA_CODE</th>
      <th>AIRPORT</th>
      <th>CITY</th>
      <th>STATE</th>
      <th>COUNTRY</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ABE</td>
      <td>Lehigh Valley International Airport</td>
      <td>Allentown</td>
      <td>PA</td>
      <td>USA</td>
      <td>40.65236</td>
      <td>-75.44040</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ABI</td>
      <td>Abilene Regional Airport</td>
      <td>Abilene</td>
      <td>TX</td>
      <td>USA</td>
      <td>32.41132</td>
      <td>-99.68190</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ABQ</td>
      <td>Albuquerque International Sunport</td>
      <td>Albuquerque</td>
      <td>NM</td>
      <td>USA</td>
      <td>35.04022</td>
      <td>-106.60919</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ABR</td>
      <td>Aberdeen Regional Airport</td>
      <td>Aberdeen</td>
      <td>SD</td>
      <td>USA</td>
      <td>45.44906</td>
      <td>-98.42183</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ABY</td>
      <td>Southwest Georgia Regional Airport</td>
      <td>Albany</td>
      <td>GA</td>
      <td>USA</td>
      <td>31.53552</td>
      <td>-84.19447</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Generar un gráfico de dispersión en el mapa de Estados Unidos para indicar la ubicación de todos los aeropuertos en nuestro conjunto de datos, utilizando el módulo <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scattergeo</span><span class="p">(</span><span class="n">locationmode</span> <span class="o">=</span> <span class="s1">&#39;USA-states&#39;</span><span class="p">,</span>
                            <span class="n">lon</span> <span class="o">=</span> <span class="n">us_airports_df</span><span class="p">[</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">],</span>
                            <span class="n">lat</span> <span class="o">=</span> <span class="n">us_airports_df</span><span class="p">[</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">],</span>
                            <span class="n">hoverinfo</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                            <span class="n">text</span> <span class="o">=</span> <span class="n">us_airports_df</span><span class="p">[</span><span class="s1">&#39;AIRPORT&#39;</span><span class="p">],</span>
                            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
                            <span class="n">marker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Airports in the USA&#39;</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">Geo</span><span class="p">(</span><span class="n">scope</span> <span class="o">=</span> <span class="s1">&#39;usa&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_105_0.svg" src="_images/section2_105_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Al pasar el ratón por encima de un punto de datos, aparecerá el nombre del aeropuerto estadounidense. ¿Se ha dado cuenta de que hay una función <code class="docutils literal notranslate"><span class="pre">add_trace()</span></code> además de la habitual creación de instancias de la clase <code class="docutils literal notranslate"><span class="pre">Scattergeo</span></code>? La función <code class="docutils literal notranslate"><span class="pre">add_trace</span></code> se utiliza porque vamos a superponer nuestros datos de vuelo en forma de líneas sobre este gráfico de dispersión en el mapa. La función <code class="docutils literal notranslate"><span class="pre">add_trace</span></code> permite a <code class="docutils literal notranslate"><span class="pre">plotly</span></code> tratar el gráfico de dispersión y los trazados de líneas como múltiples capas en el mapa.</p></li>
</ul>
<ul class="simple">
<li><p>Cargar el archivo que contiene los registros de vuelo</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_year_2015_flights_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/new_year_day_2015_delayed_flights.csv&quot;</span>
<span class="n">new_year_2015_flights_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">new_year_2015_flights_url</span><span class="p">)</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YEAR</th>
      <th>MONTH</th>
      <th>DAY</th>
      <th>DAY_OF_WEEK</th>
      <th>AIRLINE</th>
      <th>FLIGHT_NUMBER</th>
      <th>TAIL_NUMBER</th>
      <th>ORIGIN_AIRPORT</th>
      <th>DESTINATION_AIRPORT</th>
      <th>SCHEDULED_DEPARTURE</th>
      <th>...</th>
      <th>ARRIVAL_TIME</th>
      <th>ARRIVAL_DELAY</th>
      <th>DIVERTED</th>
      <th>CANCELLED</th>
      <th>CANCELLATION_REASON</th>
      <th>AIR_SYSTEM_DELAY</th>
      <th>SECURITY_DELAY</th>
      <th>AIRLINE_DELAY</th>
      <th>LATE_AIRCRAFT_DELAY</th>
      <th>WEATHER_DELAY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>HA</td>
      <td>17</td>
      <td>N389HA</td>
      <td>LAS</td>
      <td>HNL</td>
      <td>145</td>
      <td>...</td>
      <td>610.0</td>
      <td>15.0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>B6</td>
      <td>2134</td>
      <td>N307JB</td>
      <td>SJU</td>
      <td>MCO</td>
      <td>400</td>
      <td>...</td>
      <td>730.0</td>
      <td>85.0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>B6</td>
      <td>2276</td>
      <td>N646JB</td>
      <td>SJU</td>
      <td>BDL</td>
      <td>438</td>
      <td>...</td>
      <td>908.0</td>
      <td>89.0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>17.0</td>
      <td>0.0</td>
      <td>72.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>US</td>
      <td>425</td>
      <td>N174US</td>
      <td>PDX</td>
      <td>PHX</td>
      <td>520</td>
      <td>...</td>
      <td>950.0</td>
      <td>60.0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>AA</td>
      <td>89</td>
      <td>N3KVAA</td>
      <td>IAH</td>
      <td>MIA</td>
      <td>520</td>
      <td>...</td>
      <td>935.0</td>
      <td>54.0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>54.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 31 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Junto con los aeropuertos de origen y destino de cada vuelo, necesitamos tener la información de longitud y latitud de los aeropuertos correspondientes. Para ello necesitamos fusionar los <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> que contienen los datos del aeropuerto y del vuelo. Primero fusionamos los dos conjuntos de datos para obtener las longitudes y latitudes de los de todos los vuelos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge the DataFrames on origin airport codes</span>
<span class="n">new_year_2015_flights_df</span> <span class="o">=</span> <span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">us_airports_df</span><span class="p">[[</span><span class="s1">&#39;IATA_CODE&#39;</span><span class="p">,</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">,</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">]],</span> \
                                                          <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ORIGIN_AIRPORT&#39;</span><span class="p">,</span> \
                                                          <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;IATA_CODE&#39;</span><span class="p">,</span> \
                                                          <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># drop the duplicate column containing airport code</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;IATA_CODE&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># rename the latitude and longitude columns to reflect that they correspond to the origin airport</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">:</span><span class="s2">&quot;ORIGIN_AIRPORT_LATITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;LONGITUDE&quot;</span><span class="p">:</span><span class="s2">&quot;ORIGIN_AIRPORT_LONGITUDE&quot;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YEAR</th>
      <th>MONTH</th>
      <th>DAY</th>
      <th>DAY_OF_WEEK</th>
      <th>AIRLINE</th>
      <th>FLIGHT_NUMBER</th>
      <th>TAIL_NUMBER</th>
      <th>ORIGIN_AIRPORT</th>
      <th>DESTINATION_AIRPORT</th>
      <th>SCHEDULED_DEPARTURE</th>
      <th>...</th>
      <th>DIVERTED</th>
      <th>CANCELLED</th>
      <th>CANCELLATION_REASON</th>
      <th>AIR_SYSTEM_DELAY</th>
      <th>SECURITY_DELAY</th>
      <th>AIRLINE_DELAY</th>
      <th>LATE_AIRCRAFT_DELAY</th>
      <th>WEATHER_DELAY</th>
      <th>ORIGIN_AIRPORT_LATITUDE</th>
      <th>ORIGIN_AIRPORT_LONGITUDE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>HA</td>
      <td>17</td>
      <td>N389HA</td>
      <td>LAS</td>
      <td>HNL</td>
      <td>145</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>HA</td>
      <td>7</td>
      <td>N395HA</td>
      <td>LAS</td>
      <td>HNL</td>
      <td>900</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>AA</td>
      <td>1623</td>
      <td>N438AA</td>
      <td>LAS</td>
      <td>DFW</td>
      <td>905</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>133.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>DL</td>
      <td>1530</td>
      <td>N954DN</td>
      <td>LAS</td>
      <td>MSP</td>
      <td>920</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>WN</td>
      <td>1170</td>
      <td>N902WN</td>
      <td>LAS</td>
      <td>ELP</td>
      <td>950</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 33 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Ahora, realizaremos una fusión similar para obtener los datos de latitud y longitud de los aeropuertos de destino de todos los vuelos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge the DataFrames on destination airport codes</span>
<span class="n">new_year_2015_flights_df</span> <span class="o">=</span> <span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">us_airports_df</span><span class="p">[[</span><span class="s1">&#39;IATA_CODE&#39;</span><span class="p">,</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">,</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">]],</span> \
                                                          <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;DESTINATION_AIRPORT&#39;</span><span class="p">,</span> \
                                                          <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;IATA_CODE&#39;</span><span class="p">,</span> \
                                                          <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># drop the duplicate column containing airport code</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;IATA_CODE&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># rename the latitude and longitude columns to reflect that they correspond to the destination airport</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">:</span><span class="s1">&#39;DESTINATION_AIRPORT_LATITUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;LONGITUDE&#39;</span><span class="p">:</span><span class="s1">&#39;DESTINATION_AIRPORT_LONGITUDE&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">new_year_2015_flights_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YEAR</th>
      <th>MONTH</th>
      <th>DAY</th>
      <th>DAY_OF_WEEK</th>
      <th>AIRLINE</th>
      <th>FLIGHT_NUMBER</th>
      <th>TAIL_NUMBER</th>
      <th>ORIGIN_AIRPORT</th>
      <th>DESTINATION_AIRPORT</th>
      <th>SCHEDULED_DEPARTURE</th>
      <th>...</th>
      <th>CANCELLATION_REASON</th>
      <th>AIR_SYSTEM_DELAY</th>
      <th>SECURITY_DELAY</th>
      <th>AIRLINE_DELAY</th>
      <th>LATE_AIRCRAFT_DELAY</th>
      <th>WEATHER_DELAY</th>
      <th>ORIGIN_AIRPORT_LATITUDE</th>
      <th>ORIGIN_AIRPORT_LONGITUDE</th>
      <th>DESTINATION_AIRPORT_LATITUDE</th>
      <th>DESTINATION_AIRPORT_LONGITUDE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>HA</td>
      <td>17</td>
      <td>N389HA</td>
      <td>LAS</td>
      <td>HNL</td>
      <td>145</td>
      <td>...</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
      <td>21.31869</td>
      <td>-157.92241</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>HA</td>
      <td>7</td>
      <td>N395HA</td>
      <td>LAS</td>
      <td>HNL</td>
      <td>900</td>
      <td>...</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>36.08036</td>
      <td>-115.15233</td>
      <td>21.31869</td>
      <td>-157.92241</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>UA</td>
      <td>253</td>
      <td>N768UA</td>
      <td>IAH</td>
      <td>HNL</td>
      <td>920</td>
      <td>...</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>0.0</td>
      <td>42.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>29.98047</td>
      <td>-95.33972</td>
      <td>21.31869</td>
      <td>-157.92241</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>UA</td>
      <td>328</td>
      <td>N210UA</td>
      <td>DEN</td>
      <td>HNL</td>
      <td>1130</td>
      <td>...</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>31.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>39.85841</td>
      <td>-104.66700</td>
      <td>21.31869</td>
      <td>-157.92241</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>UA</td>
      <td>1173</td>
      <td>N56859</td>
      <td>SFO</td>
      <td>HNL</td>
      <td>805</td>
      <td>...</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>37.61900</td>
      <td>-122.37484</td>
      <td>21.31869</td>
      <td>-157.92241</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 35 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Ahora, dibujaremos nuestros gráficos de líneas. Para cada vuelo, tenemos que dibujar una línea entre el aeropuerto de origen y el de destino. Esto se hace proporcionando los valores de latitud y longitud de los aeropuertos de destino y origen a los parámetros <code class="docutils literal notranslate"><span class="pre">lon</span></code> y <code class="docutils literal notranslate"><span class="pre">lat</span></code> de <code class="docutils literal notranslate"><span class="pre">Scattergeo</span></code> y ajustando el modo a líneas en lugar de marcadores. Además, fíjate en que aquí estamos utilizando otra función <code class="docutils literal notranslate"><span class="pre">add_trace</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now, we will draw our line plots -- for each flight, we need to draw a line between the origin and destination airport. This is done by providing the latitude and longitude values of destination and origin airports to the lonand lat parameters of Scattergeo and setting mode to &#39;lines&#39; instead of &#39;markers&#39;. Also, notice that we are using another add_trace function here. It may take a few minutes for the plot to show the flight routes.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_year_2015_flights_df</span><span class="p">)):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scattergeo</span><span class="p">(</span>
            <span class="n">locationmode</span> <span class="o">=</span> <span class="s1">&#39;USA-states&#39;</span><span class="p">,</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_year_2015_flights_df</span><span class="p">[</span><span class="s1">&#39;ORIGIN_AIRPORT_LONGITUDE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">new_year_2015_flights_df</span><span class="p">[</span><span class="s1">&#39;DESTINATION_AIRPORT_LONGITUDE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_year_2015_flights_df</span><span class="p">[</span><span class="s1">&#39;ORIGIN_AIRPORT_LATITUDE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">new_year_2015_flights_df</span><span class="p">[</span><span class="s1">&#39;DESTINATION_AIRPORT_LATITUDE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Delayed flight on Jan 1, 2015 in USA&#39;</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">Geo</span><span class="p">(</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="s1">&#39;usa&#39;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_114_0.svg" src="_images/section2_114_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Los trazados de líneas en los mapas geográficos pueden ser generados usando el módulo <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code> de <code class="docutils literal notranslate"><span class="pre">plotly</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="tarea-2-1">
<h2>Tarea 2.1<a class="headerlink" href="#tarea-2-1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Trabajaremos con los conjuntos de datos <strong>Renewable Energy Consumption and Production</strong> de Our World in Data <a class="reference external" href="https://ourworldindata.org/renewable-energy">https://ourworldindata.org/renewable-energy</a>). Estos conjuntos de datos están disponibles en el repositorio <strong>GitHub</strong> del curso, púedes ser importados con las <strong>URL</strong>: <a class="reference external" href="https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/share-of-electricity-production-from-renewable-sources.csv">share-of-electricity-production-from-renewable-sources.csv</a>, <a class="reference external" href="https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/renewable-energy-consumption-by-country.csv">renewable-energy-consumption-by-country.csv</a></p></li>
<li><p>Su tarea consiste en crear mapas coropléticos de la producción y el consumo totales de energía renovable y el consumo en diferentes países del mundo animados en base a los años de años de producción/consumo entre (excluyendo) 2007 y 2017.</p></li>
</ul>
<ul class="simple">
<li><p><strong>Pasos principales</strong></p>
<ol class="simple">
<li><p>Cargar el conjunto de datos de producción de energía renovable.</p></li>
<li><p>Ordenar el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de producción en función de la característica <em>Year</em>.</p></li>
<li><p>Generar un mapa de coropletas para la producción de energía renovable utilizando el módulo <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code> animado en función del <em>Year</em>.</p></li>
<li><p>Actualice el diseño para incluir un estilo de proyección adecuado y un texto de título, y luego muestre la figura.</p></li>
<li><p>Cargue el conjunto de datos de consumo de energía renovable.</p></li>
<li><p>Convierta el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de consumo a un formato adecuado para su visualización.</p></li>
<li><p>Ordenar el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de consumo en base a la característica <em>Year</em>.</p></li>
<li><p>Generar un mapa coroplético para el consumo de energía renovable utilizando el módulo <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code> animado en función del año.</p></li>
<li><p>Actualice el diseño para incluir un estilo de proyección adecuado y un texto de título, y luego muestre la figura.</p></li>
</ol>
</li>
</ul>
<ul class="simple">
<li><p><strong>Resumen</strong></p></li>
</ul>
<p>En este capítulo hemos presentado tres tipos diferentes de visualización de datos geográficos, gráficos de dispersión y de burbujas sobre mapas geográficos y gráficos de líneas sobre mapas geográficos. Los mapas coropléticos presentan estadísticas agregadas a través de diferentes regiones de los mapas geográficos. Los gráficos de dispersión son eficaces para indicar detalles detalles sobre lugares específicos de interés, mientras que los gráficos de burbujas son útiles para presentar datos de recuento por región en un mapa. Los gráficos de líneas son útiles para visualizar las rutas de de los sistemas de transporte, por ejemplo. Estos gráficos pueden generarse fácilmente con los módulos <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code> y <code class="docutils literal notranslate"><span class="pre">graph_objects</span></code>. La animación puede realizarse con respecto a una característica numérica discreta en un conjunto de datos.</p>
</div>
</div>
<div class="section" id="modelo-predictivo-con-series-de-tiempo">
<h1>Modelo predictivo con series de tiempo<a class="headerlink" href="#modelo-predictivo-con-series-de-tiempo" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Definición:</strong>
Un <strong>proceso estocástico</strong> es una colección o familia de variables aleatorias <span class="math notranslate nohighlight">\(\{X_{t}\}_{t\in I}\)</span> ordenadas según el subíndice <span class="math notranslate nohighlight">\(t\)</span> que en general se suele identificar con el tiempo. Llamamos trayectoria del proceso a una realización del proceso estocástico. Si <span class="math notranslate nohighlight">\(I\)</span> es discreto, el proceso es en tiempo discreto. Si <span class="math notranslate nohighlight">\(I\)</span> es continuo, el proceso es en tiempo continuo.</p></li>
<li><p><strong>Observación:</strong></p>
<ul>
<li><p><em>Por tanto, para cada instante <span class="math notranslate nohighlight">\(t\)</span> tendremos una variable aleatoria distinta representada por <span class="math notranslate nohighlight">\(X_{t}\)</span>, con lo que un proceso estocástico puede interpretarse como una sucesión de variables aleatorias cuyas características pueden variar a lo largo del tiempo.</em></p></li>
<li><p><em>Un ejemplo de proceso en tiempo discreto se obtiene para <span class="math notranslate nohighlight">\(I = \{1,\dots,n\}\)</span>. En este caso, el proceso es <span class="math notranslate nohighlight">\(Y_{1}, Y_{2},\dots, Y_{n}\)</span>, y una trayectoria se denota por <span class="math notranslate nohighlight">\(y_{1}, y_{2},\dots, y_{n}\)</span>. Un ejemplo de proceso en tiempo continuo se obtiene para <span class="math notranslate nohighlight">\(I=[0, T], I=[0,\infty], I=(-\infty,\infty)\)</span></em></p></li>
</ul>
</li>
<li><p><strong>Definición:</strong> Una <strong>serie temporal</strong> es una realización parcial de un proceso estocástico de parámetro tiempo discreto, donde los elementos de <span class="math notranslate nohighlight">\(I\)</span> están ordenados y corresponden a instantes equidistantes del tiempo.</p></li>
</ul>
<p><img alt="" src="_images/stochastic_process.png" /></p>
<ul class="simple">
<li><p><strong>Definición:</strong> Un proceso estocástico <span class="math notranslate nohighlight">\((Y_{t})\)</span> es <strong>estacionario</strong> cuando las propiedades estadísticas de cualquier secuencia finita <span class="math notranslate nohighlight">\(Y_{t_{1}}, Y{t_{2}},\dots, Y{t_{n}}, (n\geq1)\)</span> de componentes de <span class="math notranslate nohighlight">\((Y_{t})\)</span> son semejantes a las de la secuencia <span class="math notranslate nohighlight">\(Y_{t_{1}+h}, Y_{t_{2}+h},\dots, Y_{t_{n}+h}\)</span> para cualquier número entero <span class="math notranslate nohighlight">\(h = \pm1, \pm2,\dots\)</span></p></li>
<li><p><strong>Definición:</strong> Un proceso estocástico <span class="math notranslate nohighlight">\((Y_{t})\)</span> es <strong>no estacionario</strong> cuando las propiedades estadísticas de al menos una secuencia finita <span class="math notranslate nohighlight">\(Y_{t_{1}}, Y{t_{2}},\dots, Y{t_{n}}, (n\geq1)\)</span> de componentes de <span class="math notranslate nohighlight">\((Y_{t})\)</span>, son diferentes de las de la secuencia <span class="math notranslate nohighlight">\(Y_{t_{1}+h}, Y_{t_{2}+h},\dots, Y_{t_{n}+h}\)</span> para al menos un número entero <span class="math notranslate nohighlight">\(h&gt;0\)</span>.</p></li>
<li><p><strong>Definición:</strong> La covarianza entre <span class="math notranslate nohighlight">\(y_{t}\)</span> y su valor en otro periodo de tiempo, digamos, <span class="math notranslate nohighlight">\(y_{t+k}\)</span> se denomina <strong>autocovarianza</strong> en el retardo <span class="math notranslate nohighlight">\(k\)</span>, y se define como
$<span class="math notranslate nohighlight">\(\gamma_{k}=Cov(y_{t}, y_{t+k})=E[(y_{t}-\mu)(y_{t+k}-\mu)]\)</span><span class="math notranslate nohighlight">\(
La colección de los valores de \)</span>\gamma_{k}, k = 0, 1, 2,\dots<span class="math notranslate nohighlight">\( se denomina función de autocovarianza. Obsérvese que la autocovarianza en el lag \)</span>k = 0<span class="math notranslate nohighlight">\( es simplemente la varianza de la serie temporal; es decir, \)</span>\gamma_{0} = \sigma_{y}^{2}<span class="math notranslate nohighlight">\(, que es constante para una serie temporal estacionaria. El coeficiente de autocorrelación en el lag \)</span>k<span class="math notranslate nohighlight">\( para una serie temporal estacionaria es
\)</span><span class="math notranslate nohighlight">\(\rho_{k}=\frac{E[(y_{t}-\mu)(y_{t+k}-\mu)]}{\sqrt{E[(y_{t}-\mu)^{2}]E[(y_{t+k}-\mu)^{2}]}}=\frac{Cov(y_{t}, y_{t+k})}{Var(y_{t})}=\frac{\gamma_{k}}{\gamma_{0}}\)</span><span class="math notranslate nohighlight">\(
La colección de los valores de \)</span>\rho_{k}, k = 0, 1, 2,\dots$ se llama <strong>función de autocorrelación (ACF)</strong>.</p></li>
<li><p><strong>Definición:</strong> Un <strong>modelo</strong> para un proceso estocástico es cualquier conjunto de hipótesis bien definidas sobre las propiedades estadísticas de dicho proceso.</p></li>
</ul>
<div class="section" id="introduccion-al-modelo-arima">
<h2>Introducción al modelo ARIMA<a class="headerlink" href="#introduccion-al-modelo-arima" title="Permalink to this headline">¶</a></h2>
<p>Los modelos <strong>ARIMA (Autorregresivo integrado de media móvil)</strong> aproximan los valores futuros de una serie temporal como una función lineal de observaciones pasadas y términos de ruido blanco. Una serie de tiempo <span class="math notranslate nohighlight">\(y_{t}\)</span> se llama un proceso de media móvil integrada autorregresiva (ARIMA) de órdenes <span class="math notranslate nohighlight">\(p, d\)</span>, y <span class="math notranslate nohighlight">\(q\)</span>, denotado ARIMA<span class="math notranslate nohighlight">\((p, d, q)\)</span> si su diferencia <span class="math notranslate nohighlight">\(d\)</span> da lugar a un proceso estacionario ARMA<span class="math notranslate nohighlight">\((p, q)\)</span>. Por lo tanto, un ARIMA<span class="math notranslate nohighlight">\((p, d, q)\)</span> puede escribirse como</p>
<div class="math notranslate nohighlight">
\[\Phi(B)(1-B)^{d}y_{t}=\delta+\Theta(B)\varepsilon_{t}\]</div>
<p>where
$<span class="math notranslate nohighlight">\(\Phi(B)=1-\sum_{i=1}^{p}\phi_{i}B^{i}\quad\text{and}\quad\Theta(B)=1-\sum_{i=1}^{q}\theta_{i}B^{i}\)</span>$</p>
<p>son los términos del operador back-shit en los AR<span class="math notranslate nohighlight">\((p)\)</span> y MA<span class="math notranslate nohighlight">\((q)\)</span> definidos como <span class="math notranslate nohighlight">\(\Phi(B)y_{t}=\delta+\varepsilon_{t}\)</span> y <span class="math notranslate nohighlight">\(y_{t}=\mu+\Theta(B)\varepsilon_{t}\)</span>, con <span class="math notranslate nohighlight">\(\delta=\mu-\phi\mu\)</span>, donde <span class="math notranslate nohighlight">\(\mu\)</span> es la media y <span class="math notranslate nohighlight">\(\varepsilon_{t}\)</span> el ruido blanco con <span class="math notranslate nohighlight">\(E(\varepsilon_{t})=0\)</span>. Así, una vez realizada la diferenciación y una serie temporal estacionaria <span class="math notranslate nohighlight">\(w_{t}=(1-B)^{d}y_{t}\)</span> es obtenida, los métodos <em>autoregresivo</em> de orden <span class="math notranslate nohighlight">\(p\)</span>: AR<span class="math notranslate nohighlight">\((p)\)</span> y <em>media movil</em>  de orden <span class="math notranslate nohighlight">\(q\)</span>: MA<span class="math notranslate nohighlight">\((q)\)</span> pueden ser aplicados para tener un modelo completo.</p>
</div>
<div class="section" id="implementacion-del-modelo-arima">
<h2>Implementación del modelo ARIMA<a class="headerlink" href="#implementacion-del-modelo-arima" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Durante esta sección estudiaremos el uso de las <strong>APIs</strong> para cargar datos de interes de estudio, los cuales en esta sección corresponden a series de tiempo financieras, especificamente la serie de tiempo de las acciones de <strong>Apple</strong> cotizadas en bolsas de valores será considerada.</p></li>
<li><p>En las secciones pasadas los datos eran cargados a un <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> usando la función <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> de <strong>Python</strong> utlizando el link de <code class="docutils literal notranslate"><span class="pre">github</span></code> en formato <code class="docutils literal notranslate"><span class="pre">raw</span></code> o simplemente con la dirección del directorio local donde reposaba el archivo en formato <em>CSV</em> que deseabamos cargar, en éste caso utlizaremos un protocolo de internet intermediario que nos permitirá obtener dichos datos.</p></li>
<li><p>Las series de tiempo financieras son de gran interés personal, pero estos modelos pueden ser aplicados a cualquier tipo de proceso discreto que requiera de predicciones para la correcta toma de decisiones.</p></li>
</ul>
<ul class="simple">
<li><p><strong>¿Qué es una API?</strong> <strong>API</strong> es el acrónimo de <strong>Application Programming Interface</strong> (Interfaz de Programación de Aplicaciones), que es un intermediario de software que permite que dos aplicaciones se comuniquen entre sí. Cada vez que usas una aplicación como Facebook, envías un mensaje instantáneo o consultas el tiempo en tu teléfono, estás usando una API. En su mayoría las <strong>API</strong> son privadas, algunas como la de <code class="docutils literal notranslate"><span class="pre">yahoo</span> <span class="pre">finance</span></code> son libres hasta cierto límite, y para cierto <code class="docutils literal notranslate"><span class="pre">futuros</span></code> y <code class="docutils literal notranslate"><span class="pre">derivados</span></code> especificos. Algunas entregan una versión de prueba, luego cuando la compañia que la ofrece nota un gran número de consultas (<code class="docutils literal notranslate"><span class="pre">queries</span></code>) por medio de su <strong>API</strong> a sus servidores desde una <strong>IP</strong> determinada, o de un <code class="docutils literal notranslate"><span class="pre">Bot</span></code> por ejemplo que hayas programado, comienzas a obtener mensajes de error direccionados a tu <strong>IP</strong> revocando la conexión. Otra opción interesante es <code class="docutils literal notranslate"><span class="pre">Quandl</span></code>, pero desafortunadamente ahora es adquisición de <code class="docutils literal notranslate"><span class="pre">Nasdaq</span></code> y lo más seguro es que exisitrán ciertos costos para el uso de la <strong>API</strong> que no existian antes. Una <strong>API</strong> que esperamos se mantenga gratuita es la de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code></p></li>
</ul>
<ul class="simple">
<li><p><strong>Finnhub Stock API:</strong> En esta sección estaremos utlizando la <strong>API</strong> de <a class="reference external" href="https://finnhub.io/">finnhub</a>. Finnhub proporciona una <strong>API</strong> de acciones en tiempo real gratuita para todos los operadores. También puede acceder a los datos de la empresa, el precio objetivo, las tendencias de recomendación, las ganancias y los datos de compensación de los directores generales a través de la <strong>API</strong>. Con la única misión de democratizar los datos financieros, <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> ofrece una <strong>API</strong> gratuita en tiempo real para <em>acciones, divisas y criptodivisas</em>. Con esta <strong>API</strong>, podrá acceder a datos en tiempo real de más de <strong>60 bolsas de valores, 10 corredores de divisas y más de 15 criptobolsas</strong>. También proporciona noticias en tiempo real para los mercados de empresas, acciones, divisas y criptomonedas. Los datos alternativos y de referencia de las empresas mundiales también se pueden recuperar a través de la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>.</p></li>
</ul>
<ul class="simple">
<li><p>Para hacer uso de la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>, debes crear una cuenta en su sitio web utilizando el correo de tu preferencia. Al crear tu cuenta automáticamente se generará una <strong>API Key</strong> que te permitirá ha cer uso de la <strong>API</strong>. Esta <strong>API Key</strong> es privada, la puedes volver a generar si la pierdes o si si está siendo usada por otra persona. La siguiente es una imágen del <strong>Dashboard</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> donde aparece tu <strong>API Key</strong>. Puedes hacer uso de <strong>Sandbox API Key</strong> para reducir el coste y el riesgo asociados a las llamadas a <strong>API</strong> de terceros durante los tests y permitir el desarrollo simultáneos para acelerar los ciclos de desarrollo de aplicaciones y reducir el <em>time-to-market</em>. Se utiliza para probar programas sospechosos que pueden contener virus u otro malware, sin permitir que el software dañe los dispositivos anfitriones. También puede usar el <strong>Webhook</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>, como método de alteración del funcionamiento de una página o aplicación web, con callbacks personalizados. Es esta sección utlizaremos sólo la <strong>API Key</strong>, el resto de funcionalidades las podrá experimentar en los informes o proyectos finales. Para mas información acerca de la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> visitar la documentación correspondiente en su sitio web: <a class="reference external" href="https://finnhub.io/docs/api">https://finnhub.io/docs/api</a></p></li>
</ul>
<img src = "figures/API.png"><ul class="simple">
<li><p>Para usar la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> desde su notebook, deberá primero instalar usando el gestor de instalación <strong>pip</strong> la librería de <strong>Python</strong> requerida para hacer uso de la <strong>API</strong> usando la orden: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">finnhub-python</span></code>. Luego de hacer esto puede comenzar a usar las diferentes funciones públicas asociadas a la clase <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> que importamos desde <strong>Python</strong> luego de la isntalación. También importaremos librería para conversiones de <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> que realizará conversiones a un formato de fecha conocido, a saber: año, mes, día <code class="docutils literal notranslate"><span class="pre">%Y-%m-%d</span></code>. Las librerías <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> y <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> ya usadas en anteriores secciones también son importadas para realizar los gráficos correspondientes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">finnhub</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>La librería <code class="docutils literal notranslate"><span class="pre">warnings</span></code> es utlizada para evitar múltiples mensaje molestos de alertas no fatales, que en gran parte de los casos están relacionados con diferentes versiones de la librería en uso.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Usamos las funciones <code class="docutils literal notranslate"><span class="pre">set_theme()</span></code> para configurar el tema a usar en las figuras, en éste caso <code class="docutils literal notranslate"><span class="pre">paper</span></code> el cual invocamos usando <code class="docutils literal notranslate"><span class="pre">set_context(&quot;paper&quot;)</span></code>. Para ver más temas para figuras con <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> visitar: <a class="reference external" href="http://seaborn.pydata.org/tutorial/aesthetics.html">http://seaborn.pydata.org/tutorial/aesthetics.html</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>En la siguiente línea hacemos usa de la función <code class="docutils literal notranslate"><span class="pre">Client</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> que se encarga de realizar la conexión con el cliente <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>, utlizando nuesta <strong>API Key</strong> y crea un objeto instanciado que podemos usar para hacer uso de toda la funcionalidad ofrecida por la <strong>API</strong>. Debe escribir la <strong>API</strong> correctamente y entre comillas para que se realice correctamente la conexión. Dependiendo de su conexión a internet y su computadora, puede obtener mensajes de <em>delay</em> por parte del cliente, en estos caso simplemente vuelva a ejecutar la conexión con su <strong>API</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">finnhub_client</span> <span class="o">=</span> <span class="n">finnhub</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;c5g56siad3id0d5no4vg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Seleccione el stock de interés. Para éste ejemplo consideramos el precio de las acciones de <strong>AAPL</strong> con un <em>timeframe</em> diario. La función <code class="docutils literal notranslate"><span class="pre">datetime.now()</span></code> nos entrega la fecha y hora actual, la función <code class="docutils literal notranslate"><span class="pre">timedelta()</span></code> nos entrega en tiempo cero, 365 días del año que vamos a restar de la fecha actual. Esto es nuestra serie de tiempo corresponde a los últimos 365 precios de las acciones de <strong>Apple</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stock</span> <span class="o">=</span> <span class="s1">&#39;AAPL&#39;</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>

<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Para obtener información de nuestra vela de precios (<strong>candlestick</strong>) procedemos a hacer uso de la función <code class="docutils literal notranslate"><span class="pre">stock_candles</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">finnhub_client</span></code> para poder obtener información en la vela. Normalemente esta información corresponde al precio al que la acción en en día indicado, abrió, cerró, su valor máximo y mínimo, volumen tradeado y el tiempo dado en días en éste caso. Para aplicaciones avanzadas como las de <strong>HFT</strong>, que necesitan los precios a una frecuencia más alta cambiaríamos la resolución <code class="docutils literal notranslate"><span class="pre">resolution</span> <span class="pre">=</span> <span class="pre">'D'</span></code> a la resolución que necesite, puede realizar hasta 60 llamados por minuto. La función <code class="docutils literal notranslate"><span class="pre">.timestamp</span></code> nos permitirá obtener nuestra fecha en formato <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code>, único formato que aceptará la función <code class="docutils literal notranslate"><span class="pre">stock_candles</span></code>. Imprima alguno de estos códigos <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> y utilice la siguiente calculadora <a class="reference external" href="https://www.epochconverter.com/">https://www.epochconverter.com/</a> para verificar por ejemplo el código de la fecha y hora actual. Observe que la columna <code class="docutils literal notranslate"><span class="pre">t</span></code> del <strong>DataFrame</strong> viene en formato <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code>. Además nótese que se realizó un cambio de formato a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, esto es porque el formato original que viene de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> es tipo <strong>JSON</strong>. Para facilitar el desarrollo de esta sección transformamos éste objeto <strong>JSON</strong> a un <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <strong>DataFrame</strong>. Cada <em>key</em> del archivo <strong>JSON</strong> corresponde a los combres de cada columna y el <em>value</em>, es una lista con los 365 datos correspondientes a la columna</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="n">AAPL_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">stock_candles</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">AAPL_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">AAPL_res</span><span class="p">)</span>

<span class="n">AAPL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>116.32</td>
      <td>121.9900</td>
      <td>116.05</td>
      <td>120.50</td>
      <td>ok</td>
      <td>1604880000</td>
      <td>154515315</td>
    </tr>
    <tr>
      <th>1</th>
      <td>115.97</td>
      <td>117.5900</td>
      <td>114.13</td>
      <td>115.55</td>
      <td>ok</td>
      <td>1604966400</td>
      <td>138023390</td>
    </tr>
    <tr>
      <th>2</th>
      <td>119.49</td>
      <td>119.6300</td>
      <td>116.44</td>
      <td>117.19</td>
      <td>ok</td>
      <td>1605052800</td>
      <td>112294954</td>
    </tr>
    <tr>
      <th>3</th>
      <td>119.21</td>
      <td>120.5300</td>
      <td>118.57</td>
      <td>119.62</td>
      <td>ok</td>
      <td>1605139200</td>
      <td>103350674</td>
    </tr>
    <tr>
      <th>4</th>
      <td>119.26</td>
      <td>119.6717</td>
      <td>117.87</td>
      <td>119.44</td>
      <td>ok</td>
      <td>1605225600</td>
      <td>81688586</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>La siguiente función la utlilizaremos para convertir de formato <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> a <code class="docutils literal notranslate"><span class="pre">datetime</span></code>, la columna <code class="docutils literal notranslate"><span class="pre">t</span></code> de la fecha en nuestr <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">AAPL_df</span></code>. Para aplicar la función a cada valor de la columna <code class="docutils literal notranslate"><span class="pre">t</span></code> usamos la función <code class="docutils literal notranslate"><span class="pre">apply</span></code>, estudiada anteriormente. Presentamos un ejemplo para que podamos visualizar el funcionamiento de la función <code class="docutils literal notranslate"><span class="pre">date_format</span></code> que recibirá como argumento un código <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> y lo transformará a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> usando la función <code class="docutils literal notranslate"><span class="pre">datetime.fromtimestamp()</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">date_format</span><span class="p">(</span><span class="n">date_col</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">date_col</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_format</span><span class="p">(</span><span class="mi">1602460800</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2020-10-11&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AAPL_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
<span class="n">AAPL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>116.32</td>
      <td>121.9900</td>
      <td>116.05</td>
      <td>120.50</td>
      <td>ok</td>
      <td>2020-11-08</td>
      <td>154515315</td>
    </tr>
    <tr>
      <th>1</th>
      <td>115.97</td>
      <td>117.5900</td>
      <td>114.13</td>
      <td>115.55</td>
      <td>ok</td>
      <td>2020-11-09</td>
      <td>138023390</td>
    </tr>
    <tr>
      <th>2</th>
      <td>119.49</td>
      <td>119.6300</td>
      <td>116.44</td>
      <td>117.19</td>
      <td>ok</td>
      <td>2020-11-10</td>
      <td>112294954</td>
    </tr>
    <tr>
      <th>3</th>
      <td>119.21</td>
      <td>120.5300</td>
      <td>118.57</td>
      <td>119.62</td>
      <td>ok</td>
      <td>2020-11-11</td>
      <td>103350674</td>
    </tr>
    <tr>
      <th>4</th>
      <td>119.26</td>
      <td>119.6717</td>
      <td>117.87</td>
      <td>119.44</td>
      <td>ok</td>
      <td>2020-11-12</td>
      <td>81688586</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Luego cambiamos los nombres de cada columna (iniciales) al nombre original que se utliza en los candlesticks de series de tiempo financieras, como se muestra en la siguiente figura. Eliminamos la columna <code class="docutils literal notranslate"><span class="pre">s</span></code> que no proporciona información relevante para las predicciones. Utilizaremos la función <code class="docutils literal notranslate"><span class="pre">rename</span></code> y <code class="docutils literal notranslate"><span class="pre">drop</span></code> ya usadas anteriormente con éste objetivo. Consideraremos para éste ejemplo el precio de cierre de la acción, debido a que es el más utlizado cuando deseamos tomar decisiones de inversión</p></li>
</ul>
<p><img alt="" src="_images/candletick.png" /></p>
<ul class="simple">
<li><p>La siguiente figura es extraida de <a class="reference external" href="https://www.tradingview.com/">tradingview</a>, y representa el precio diario de las acciones de <strong>APPLE</strong> cotizadas en <strong>Nasdaq</strong> uno de los principales exchange de futuros y derivados <strong>in the Street</strong>. Distintas predicciones se pueden realizar por medio del uso de <strong>análisis técnico</strong> y <strong>análisis fundamental</strong> por ejemplo. En éste caso usaremos el modelo <strong>ARIMA</strong> como herramienta predictiva para horizontes cortos. Si desea experimentar un poco el análisis técnico realizado por aproximadamente un 90% de los traders, recomiendo usar <strong>Bitmex Testnet</strong> e iniciar con una wallet con <strong>Bitcoins</strong> de prueba (<em>paper version</em>), para adquirir destrezas antes de realizar alguna inversión, el análisis técnico es una técnica que requiere de muchos años de experiencia y disciplina para obtener resultados exitosos.</p></li>
</ul>
<p><img alt="" src="_images/AAPL_tradingview.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="s1">&#39;High&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">:</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="s1">&#39;Volume&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">AAPL_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">AAPL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Date</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>116.32</td>
      <td>121.9900</td>
      <td>116.05</td>
      <td>120.50</td>
      <td>2020-11-08</td>
      <td>154515315</td>
    </tr>
    <tr>
      <th>1</th>
      <td>115.97</td>
      <td>117.5900</td>
      <td>114.13</td>
      <td>115.55</td>
      <td>2020-11-09</td>
      <td>138023390</td>
    </tr>
    <tr>
      <th>2</th>
      <td>119.49</td>
      <td>119.6300</td>
      <td>116.44</td>
      <td>117.19</td>
      <td>2020-11-10</td>
      <td>112294954</td>
    </tr>
    <tr>
      <th>3</th>
      <td>119.21</td>
      <td>120.5300</td>
      <td>118.57</td>
      <td>119.62</td>
      <td>2020-11-11</td>
      <td>103350674</td>
    </tr>
    <tr>
      <th>4</th>
      <td>119.26</td>
      <td>119.6717</td>
      <td>117.87</td>
      <td>119.44</td>
      <td>2020-11-12</td>
      <td>81688586</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Utilizaremos la función <code class="docutils literal notranslate"><span class="pre">lineplot</span></code> de <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> para realizar un gráfico de la serie de tiempo de interés. Dado que el volumen de datos es amplio, para poder visualizar fechas en el eje <span class="math notranslate nohighlight">\(x\)</span> por ejemplo usamos la función <code class="docutils literal notranslate"><span class="pre">get_xticks()</span></code> para obtener estas fechas cambiar la frecuencia a ser colocada <strong>solo</strong> en la figura, para poder tener una visualización agradable a la vista. Dado que los nombres de cada etiqueta corresponden a strings de fechas, para evitar que queden uno sobre otro, rotamos los labels en éste eje usano la función <code class="docutils literal notranslate"><span class="pre">plt.xticks(rotation=50)</span></code>, nótese que se ha colocado <code class="docutils literal notranslate"><span class="pre">;</span></code> al final de éste llamado, <strong>¿Con que objetivo?</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_155_0.png" src="_images/section2_155_0.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Gráficos de velas en Python:</strong> El gráfico de velas es un estilo de gráfico financiero que describe la apertura, el máximo, el mínimo y el cierre para una coordenada <span class="math notranslate nohighlight">\(x\)</span> determinada (probablemente la hora). Los recuadros representan la dispersión entre los valores de apertura y cierre y las líneas representan la dispersión entre los valores bajos y altos. Los puntos de muestra en los que el valor de cierre es mayor (menor) que el de apertura se denominan crecientes (decrecientes). Por defecto, las velas crecientes se dibujan en verde mientras que las decrecientes se dibujan en rojo. Para realizar la figura usamos la función <code class="docutils literal notranslate"><span class="pre">Figure()</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">go</span></code> de <code class="docutils literal notranslate"><span class="pre">plotly</span></code>, esta función recibe como input los datos asociados al candlestick suministrados por medio de la función <code class="docutils literal notranslate"><span class="pre">Candlestick</span></code> también de la clase <code class="docutils literal notranslate"><span class="pre">go</span></code> de <code class="docutils literal notranslate"><span class="pre">plotly</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Candlestick</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
                                     <span class="nb">open</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Open</span><span class="p">,</span> 
                                     <span class="n">high</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">High</span><span class="p">,</span>
                                     <span class="n">low</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Low</span><span class="p">,</span> 
                                     <span class="n">close</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
                     <span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Apple Inc. (AAPL)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;AAPL-USD&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RebeccaPurple&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_157_0.svg" src="_images/section2_157_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Utilizaremos ahora una prueba estadística para verificar si la serie de tiempo es estacionaria o no. Esta prueba es la de  <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code>. En cursos avanzados de <strong>series de tiempo</strong> se estudia estadísticamente éste tipo de pruebas así como los plots <strong>ACF</strong> y <strong>PACF</strong>, en esta sección sólo mencionaremos en una bastante resumida la idea detras de su uso. Para hacer uso de esta prueba importamos la función <code class="docutils literal notranslate"><span class="pre">adfuller</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">statsmodels.tsa.stattools</span></code>. Para aplicar el test pasamos los datos del precio de cierre, serie de tiempo de interés, usando <code class="docutils literal notranslate"><span class="pre">AAPL_df.Close</span></code>. Éste será el argumento de la función <code class="docutils literal notranslate"><span class="pre">adfuller</span></code> encargada de realizar el test de <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -1.651440
p-value: 0.456290
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Dado que el valor crítico, el estadístico <code class="docutils literal notranslate"><span class="pre">ADF</span> <span class="pre">=-1,8</span> <span class="pre">&gt;</span> <span class="pre">-2,5,-3,4,-2,8</span></code> (valores <span class="math notranslate nohighlight">\(t\)</span> en intervalos de confianza de 1%,5% y 10%), se acepta la hipótesis nula <span class="math notranslate nohighlight">\((H_{o})\)</span></p></li>
<li><p>Valor <span class="math notranslate nohighlight">\(p-\)</span><code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">0,480737</span> <span class="pre">&gt;</span> <span class="pre">0,05</span></code>. Dado que el valor <span class="math notranslate nohighlight">\(p\)</span> de Adfuller es mayor que un determinado valor alfa especificado (5%, nivel de significación o intervalo de confianza del 95%), se acepta la hipótesis nula <span class="math notranslate nohighlight">\((H_{o})\)</span>, es decir, la serie temporal no es estacionaria</p></li>
</ul>
<ul class="simple">
<li><p>Realizaremos ahora figuras de <strong>autocorrelación</strong> para confirmar que la serie de tiempo es estacionaria, así como también para verificar cual es el orden de integración necesario para llevar nuestra serie de tiempo no estacionaria a una estacionaría. Para esto usaremos la función <code class="docutils literal notranslate"><span class="pre">plot_acf</span></code> de <strong>Python</strong>, la cual recibe como argumentos, la serie de tiempo de interés y el número de <em>lags</em>* que deseamos considerar en la figura. Nótese que utlizamos la función <code class="docutils literal notranslate"><span class="pre">.diff()</span></code> para realizar diferenciación en nuestra serie de tiempo, con el objetivo de remover tendencia, además nótese también que se eliminan valores <code class="docutils literal notranslate"><span class="pre">nan</span></code> que podamos obtener en éste proceso debido a que está figura consiste en graficar todos los valores <span class="math notranslate nohighlight">\(\rho_{k}\)</span> definidos anteriormente, donde aparece un cociente para el cual evitamos valores nulos en el denominador. Realizaremos tres figuras, correspondientes a la autocorrelación de la serie original, la serie diferenciada una vez, y dos veces. Colocaremos estas figuras en una matriz de <span class="math notranslate nohighlight">\(3\times2\)</span> usando la función <code class="docutils literal notranslate"><span class="pre">fig,</span> <span class="pre">axes</span> <span class="pre">=</span> <span class="pre">plt.subplots(3,</span> <span class="pre">2,</span> <span class="pre">sharex=True)</span></code> de <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>. Para que cree que se usa el llamado <code class="docutils literal notranslate"><span class="pre">sharex=True</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">240</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">240</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">240</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_164_0.png" src="_images/section2_164_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Nótese el <strong>decaimiento geométrico</strong> en la primera figura de autocorrelación, que baja desde la parte positiva con una tendencia lineal, la cual es interpretada como una autocorrelación asociada a una serie de tiempo no estacionaría como indica la prueba de <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code> que presenta efectivamente tendencias. Los intervalos de confianza se dibujan como un cono. Por defecto, se establece un intervalo de confianza del 95%. Al observar el gráfico de autocorrelación para la segunda diferenciación, el retardo entra en la zona negativa con bastante rapidez, lo que indica que la serie podría haber sido sobrediferenciada.</p></li>
</ul>
<ul class="simple">
<li><p>Definimos ahora nuestro conjuntos de entrenamiento y testeo para el modelo <strong>ARIMA</strong>, en éste caso nuestro <strong>test</strong> corresponde a los últimos 7 precios de las acciones de <strong>AAPL</strong>, y el <strong>train</strong> corresponde a la serie de tiempo original menos estos 7 días. El mejor modelo será obtenido mediante uso de los datos de entrenamiento y el criterio de <strong>Akaike</strong> y de <strong>inferencia Bayesiana</strong> el cual penaliza la suma de los residuos al cuadrado por incluir parámetros adicionales en el modelo, los modelos que tienen valores pequeños del <strong>AIC</strong> o <strong>BIC</strong> se consideran buenos modelos. El primer término del AIC o BIC es la función de <strong>verosimilitud</strong> para el modelo ajustado evaluada en las estimaciones de <strong>máxima verosimilitud</strong> de los parámetros desconocidos. En este contexto, <strong>AIC y SIC</strong> se denominan <strong>criterios de verosimilitud penalizados</strong>. En esta sección seleccionaremos el modelo con el menor <strong>AIC</strong> debido a que el <strong>AIC</strong> es <strong>asintóticamente eficiente</strong> (<em>menor error de predicción en nuevos datos</em>) pero el <strong>BIC</strong> no lo es. Más sobre esta técnica y el principio de máxima verosimilitud para selecciona de un buen modelo <strong>ARIMA</strong>, es abordado en cursos electivos de <strong>análisis de series de tiempo</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[AIC=\ln\left(\frac{\sum_{t=1}^{T}e_{t}^{2}}{T}\right)+\frac{2p}{T},\quad BIC=\ln\left(\frac{\sum_{t=1}^{T}e_{t}^{2}}{T}\right)+\frac{p\ln(T)}{T}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_AAPL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># This can be changed</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_AAPL</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_1w</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_1w</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test_1w:&quot;</span><span class="p">,</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>train: (245,)
test_1w: (7,)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utlizamos ahora el modelo <code class="docutils literal notranslate"><span class="pre">ARIMA</span></code> importado desde la librería <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> de <strong>Python</strong> para obetener distintos <strong>ARIMA</strong> de ordenes <span class="math notranslate nohighlight">\(p,d,q\)</span>. Consideramos <code class="docutils literal notranslate"><span class="pre">method</span> <span class="pre">=</span> <span class="pre">'mle'</span></code> para el cálculo de la <strong>verosimilitud</strong> exacta a través del <strong>filtro de Kalman</strong>. Como ejercicio puede reescribir estas líneas de código en una función que dependa sólo del input <code class="docutils literal notranslate"><span class="pre">train</span></code> y retorne los ordenes <span class="math notranslate nohighlight">\(p, d, q\)</span> asociados al criterio <strong>AIC</strong> de bondad de ajuste</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">d_rng</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">)</span>
                <span class="n">tmp_aic</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>                
                <span class="k">if</span> <span class="n">tmp_aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                    <span class="n">best_aic</span> <span class="o">=</span> <span class="n">tmp_aic</span>
                    <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aic: </span><span class="si">{:6.5f}</span><span class="s1"> | order: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_aic</span><span class="p">,</span> <span class="n">best_order</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>aic: 1053.04714 | order: (3, 1, 3)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Existe una función llamada <code class="docutils literal notranslate"><span class="pre">auto_arima</span></code> de <strong>Python</strong> la cual es útli en ciertos casos especificos. Éste no es uno de ellos dado que el modelo <strong>ARIMA</strong> que entrega es un simple random walk <span class="math notranslate nohighlight">\(x_{t}=x_{t-1}+\omega_{t}\)</span>, el cual predice puramente como un modelo estocástico con dependencia temporal basado totalmente en el punto temporal anterior <span class="math notranslate nohighlight">\(t-1\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>       <span class="c1"># use adftest to find optimal &#39;d&#39;</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># maximum p and q</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>              <span class="c1"># frequency of series</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>           <span class="c1"># let model determine &#39;d&#39;</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>   <span class="c1"># No Seasonality</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>  
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,1,1)(0,0,0)[0] intercept   : AIC=1055.416, Time=0.20 sec
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(0,1,0)(0,0,0)[0] intercept   : AIC=1052.055, Time=0.02 sec
 ARIMA(1,1,0)(0,0,0)[0] intercept   : AIC=1053.830, Time=0.03 sec
 ARIMA(0,1,1)(0,0,0)[0] intercept   : AIC=1053.822, Time=0.04 sec
 ARIMA(0,1,0)(0,0,0)[0]             : AIC=1051.306, Time=0.02 sec

Best model:  ARIMA(0,1,0)(0,0,0)[0]          
Total fit time: 0.320 seconds
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Por lo tanto para éste problema consideramos los mejores ordenes <span class="math notranslate nohighlight">\(p, d, q\)</span> obtenidos a a partir del criterio de Akaike. Los usamos como argumento de entrada en nuestro modelo <strong>ARIMA</strong> junto a nuestro <em>train set</em>, para obtener el modelo de ajustado de interés que utlizaremos para predecir valores futuros usando <em>rolling</em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Para graficar el ajuste de nuestro modelo <strong>ARIMA</strong> frente a nuestra serie de tiempo real utlizamos la función <code class="docutils literal notranslate"><span class="pre">.plot_predict</span></code> que proviene del objeto instanciado usando la función <strong>ARIMA</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">model_fit</span><span class="o">.</span><span class="n">plot_predict</span><span class="p">(</span><span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real vs. ARIMA Forecast (Train)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Real vs. ARIMA Forecast (Train)&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 864x576 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/section2_177_2.png" src="_images/section2_177_2.png" />
</div>
</div>
<ul class="simple">
<li><p>Para medir el error de predicción cometido en las predicciones, utilizaremos las métricas usuales en análisis de series de tiempo: <code class="docutils literal notranslate"><span class="pre">MAPE,</span> <span class="pre">MAE,</span> <span class="pre">RMSE,</span> <span class="pre">MSE</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
    
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                 <span class="c1"># MAE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span>               <span class="c1"># RMSE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># MSE</span>
    
    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                           <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                           <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                           <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">]},</span>
                          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Realizamos ahora predicciones utlilizando <em>rolling forecasting</em>. El <em>rolling forecast</em> entrega reportes que utilizan datos históricos para predecir cifras futuras de forma continua durante un periodo de tiempo. Las previsiones continuas se utilizan a menudo en los reportes financieros, la gestión de la cadena de suministro, la planificación y la elaboración de presupuestos. El <em>rolling forecast</em> es una ayuda esencial para tomar decisiones empresariales acertadas. Gracias a su capacidad de respuesta, las previsiones continuas ayudan a las empresas a responder más rápidamente a las condiciones cambiantes del mercado. Si se utilizan con eficacia, las previsiones continuas pueden ayudar a identificar las deficiencias de rendimiento, acortar los ciclos de planificación y tomar la mejor decisión para los resultados. Para nuestros ejemplos, nuestro horizonte de predicción será de un día</p></li>
</ul>
<p><img alt="" src="_images/rolling.ppm" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predicted=</span><span class="si">%f</span><span class="s1">, expected=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yhat</span><span class="p">,</span> <span class="n">obs</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=152.662026, expected=149.800000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=149.785056, expected=148.960000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=148.636426, expected=150.020000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=149.622634, expected=151.490000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=151.060422, expected=150.960000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=150.917737, expected=151.280000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=151.328948, expected=150.440000
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utilizaremos ahora las funciónes creadas anteriormente para calcular el error de predicción y <code class="docutils literal notranslate"><span class="pre">linpeplot</span></code> para graficarle junto a la serie de tiempo orginal de test</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="s2">&quot;week 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>week 1</th>
      <td>1.184236</td>
      <td>2.172113</td>
      <td>0.007855</td>
      <td>1.473809</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_186_0.png" src="_images/section2_186_0.png" />
</div>
</div>
</div>
<div class="section" id="tarea-2-2">
<h2>Tarea 2.2<a class="headerlink" href="#tarea-2-2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Considere la serie de tiempo asociada con los futuros de la criptomoneda <strong>Bitcoin</strong> desde que comenzó a tradearse hasta la fecha del día de hoy. Utilice la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> para obtener esta serie de tiempo. Recuerde que para esto debe crear primero una cuenta, y así obtener su <strong>API Key</strong> para realizar la conexión de forma efectiva.</p></li>
<li><p>Repita <strong>TODOS</strong> los pasos indicados en esta sección para encontrar modelos <strong>ARIMA</strong> para predecir el precio de <strong>Bitcoin</strong> con los siguientes horizontes: <strong>7 días, 14 días, 21 días, 28 días</strong>. Utilizar siempre predicciones usando <em>rolling</em> con ventana de predicción continua de un día. Cualquier cantidad de pasos extra para enriqucer su anális predictivo serán aceptados siempre y cuando sean acordes con lo que indica la teoría de análisis de series de tiempo.</p></li>
<li><p>Realice una tabla de error utlizando las métricas: <code class="docutils literal notranslate"><span class="pre">MAPE,</span> <span class="pre">MAE,</span> <span class="pre">RMSE,</span> <span class="pre">MSE</span></code>.</p></li>
<li><p>Repita el análisis desarrollado en los pasos anteriores considerando ahora el criterio de <strong>inferencia Bayesiana (BIC)</strong> para encontrar el mejor modelo <strong>ARIMA</strong> y compare los errores con aquellos obtenidos con el criterio de <strong>Akaike</strong>.</p></li>
<li><p>Escriba en cada paso las concluiones y análisis estadísticos asociados con los resultados obtenidos. Realice un test de normalidad para los residuales obtenidos para cada predicción, en cada caso agregue las correspondientes conlusiones estadísticas. Figuras y algoritmos que no estén acompañados de una conclusión, descripción y análisis estadístico, no serán tenidas en cuenta.</p></li>
</ul>
</div>
</div>
<div class="section" id="errores-comunes-al-crear-visualizaciones-interactivas">
<h1>Errores comunes al crear visualizaciones interactivas<a class="headerlink" href="#errores-comunes-al-crear-visualizaciones-interactivas" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Objetivos</strong></p>
<ul>
<li><p>Identificar los errores que se cometen al crear visualizaciones</p></li>
<li><p>Aplicar técnicas para corregir los errores y crear visualizaciones eficaces</p></li>
<li><p>Seleccionar y diseñar las visualizaciones adecuadas para determinados tipos de datos</p></li>
<li><p>Describir las diferentes bibliotecas y herramientas disponibles para crear visualizaciones</p></li>
</ul>
</li>
</ul>
<div class="section" id="id1">
<h2>Introducción<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>En éste capítulo se enumera y explica los posibles fallos y errores que se cometen durante varias etapas del proceso de visualización de datos, como la visualización de elementos no correlacionados de un conjunto de datos para mostrar una relación o crear una característica interactiva inapropiada</p></li>
<li><p>El proceso de visualización de datos puede parecer sencillo: tome algunos datos, trace algunos gráficos, añadir algunas características interactivas, y el trabajo está hecho. O, tal vez, no lo sea: podrían haber varios lugares durante el trayecto en los que se pueden cometer errores. Estos errores terminan por dar lugar a una visualización defectuosa que no puede de manera fácil y eficaz transmitir lo que dicen los datos, lo que hace que sea completamente inútil para el público que lo está viendo.</p></li>
</ul>
</div>
<div class="section" id="formato-e-interpretacion-de-datos">
<h2>Formato e interpretación de datos<a class="headerlink" href="#formato-e-interpretacion-de-datos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>La primera fase de la visualización de datos es entender los datos frente a ti: entender lo que es, lo que significa y lo que transmite. Sólo cuando entiendas los datos serás capaz de diseñar una visualización que ayude a otros a entenderlos.</p></li>
<li><p>Además, es importante asegurarse de que los datos tienen sentido y contienen suficiente información, ya sea categórica, numérica o una mezcla de ambas, para ser visualizados. Por lo tanto, si tratas con datos erróneos o sucios, es probable que la visualización sea defectuosa.</p></li>
<li><p>En esta siguiente sección, veremos algunas formas de evitar los errores comunes que se suelen cometidos en esta fase de los datos y cómo evitarlos.</p></li>
</ul>
<p><strong>¿Cómo evitar los errores más comunes al tratar con datos sucios?</strong></p>
<ul class="simple">
<li><p>Garbage In, Garbage Out - este es un dicho popular en el campo de la ciencia de datos, especialmente con respecto a la visualización de datos. Básicamente significa que si utilizas datos desordenados y ruidosos, vas a obtener una visualización defectuosa y poco informativa. Los datos desordenados, ruidosos y sucios corresponden a una serie de problemas que se encuentran en los datos. Vamos a discutir los problemas uno por uno y las formas de tratar este tipo de datos.</p></li>
</ul>
<p><strong>Valores atípicos</strong></p>
<ul class="simple">
<li><p>Los datos que contienen valores inexactos o instancias que son significativamente diferentes del resto de los datos de un conjunto de datos se denominan valores atípicos. Estos valores atípicos pueden ser auténticos, es decir, parecen incorrectos pero en realidad no lo son, o son errores que se cometen al recoger o almacenar los datos. Veamos un ejemplo de un error cometido al recoger o almacenar los datos. La siguiente tabla muestra la edad, el peso y el sexo de los clientes que acuden a un determinado gimnasio. La columna de sexo consta de tres valores discretos 0, 1 y 2 que corresponden todos a una clase: hombre, mujer y otro, respectivamente. La columna de la edad se expresa en años y la columna de peso está en kilogramos</p></li>
</ul>
<p><img alt="" src="_images/Figure701.png" /></p>
<ul class="simple">
<li><p>Todo parece correcto hasta que llegamos a la cuarta instancia (índice 3), donde el peso peso es de 790 kg. Esto parece extraño porque nadie puede pesar realmente 790 kg, especialmente alguien cuya estatura es de 1,5 metros y 7 pulgadas. Quien haya almacenado estos datos debe haber querido decir 79 kg y haber añadido un 0 por error. Este es un caso de un valor atípico en el conjunto de datos. Esto puede parecer trivial en este momento, sin embargo, esto puede resultar en visualizaciones defectuosas, y predicciones o patrones de modelos de aprendizaje automático, especialmente si hay múltiples repeticiones de esos datos. Ahora, veamos un ejemplo de un auténtico valor atípico en la siguiente tabla</p></li>
</ul>
<p><img alt="" src="_images/Figure702.png" /></p>
<ul class="simple">
<li><p>El peso en el cuarto caso (índice 3) es de 167 kilogramos, lo que parece extrañamente alto. Sin embargo, sigue siendo un valor verosímil, ya que es posible que alguien tenga un peso de 167 kilogramos a los 37 años. Por lo tanto, se trata de un un verdadero valor atípico. Mientras que en los ejemplos anteriores es fácil detectar el valor atípico, ya que sólo hay 5 casos, en realidad, nuestros conjuntos de datos son masivos, por lo que comprobar cada caso es una tarea tediosa y poco práctica. Por lo tanto, en la vida real, podemos utilizar visualizaciones estáticas básicas, como los gráficos de caja, para observar la existencia de valores atípicos. Los gráficos de caja son visualizaciones de datos sencillas pero informativas que pueden decirnos mucho sobre la sobre la forma en que se distribuyen nuestros datos. Muestran el rango de nuestros datos basándose en cinco valores clave:</p>
<ul>
<li><p>El valor mínimo de la columna</p></li>
<li><p>El primer cuartil</p></li>
<li><p>La mediana</p></li>
<li><p>El tercer cuartil</p></li>
<li><p>El valor máximo de la columna</p></li>
</ul>
</li>
<li><p>Esto es lo que hace que sean excelentes para mostrar los valores atípicos, además de describir la simetría de los datos, el grado de agrupación de los mismos (si todos los valores están repartidos en un amplio rango), y si están o no sesgados.</p></li>
</ul>
</div>
<div class="section" id="ejercicio-52-visualizacion-de-valores-atipicos-en-un-conjunto-de-datos-con-un-grafico-de-cajas">
<h2>Ejercicio 52: Visualización de valores atípicos en un conjunto de datos con un gráfico de cajas<a class="headerlink" href="#ejercicio-52-visualizacion-de-valores-atipicos-en-un-conjunto-de-datos-con-un-grafico-de-cajas" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>En este ejercicio, vamos a crear un gráfico de caja para comprobar si nuestro conjunto de datos contiene valores atípicos. Vamos a utilizar el conjunto de datos <em>gym.csv</em>, que contiene información sobre los clientes de un determinado gimnasio.</p></li>
</ul>
<ul class="simple">
<li><p>Importar las librerías necesarias</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Guarda el archivo <em>gym.csv</em> en un DataFrame llamado <strong>gym</strong>, e imprime las cinco primeras filas del mismo para ver cómo son los datos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gym</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/gym.csv&#39;</span><span class="p">)</span>
<span class="n">gym</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>88</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>45</td>
      <td>96</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35</td>
      <td>91</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>37</td>
      <td>790</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>62</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Como puede ver, nuestros datos tienen tres columnas: edad, peso y sexo. La columna sexo consta de tres valores discretos que corresponden a tres clases discretas - 0 es hombre, 1 es mujer y 2 es otro.</p></li>
<li><p>Cree un gráfico de caja con el eje <span class="math notranslate nohighlight">\(x\)</span> como columna de sexo y el eje <span class="math notranslate nohighlight">\(y\)</span> como peso</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">gym</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">notched</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_208_0.svg" src="_images/section2_208_0.svg" /></div>
</div>
<ul class="simple">
<li><p>La escala del eje <span class="math notranslate nohighlight">\(y\)</span> es extrañamente grande, ya que todos los gráficos de caja están comprimidos en la octava parte inferior del gráfico, por lo que no representa una visualización clara de los datos. Esto se debe al valor atípico en la cuarta instancia de nuestro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <strong>790 kg</strong></p></li>
<li><p>Todos los valores parecen estar bien, excepto ese valor atípico en la parte superior del gráfico con <strong>max=790</strong>. Ahora, veremos las formas de tratar los valores atípicos.</p></li>
</ul>
<p><strong>Cómo tratar los valores atípicos</strong></p>
<p>Hay tres formas principales de tratar los valores atípicos:</p>
<ul class="simple">
<li><p><strong>Eliminación</strong>: Si sólo hay unas pocas instancias (filas) que poseen valores atípicos, entonces esas instancias pueden ser eliminadas completamente del conjunto de datos, dejando así un conjunto de datos con cero valores atípicos. También hay ocasiones en las que una determinada característica (columna) contiene un gran número de valores atípicos. En tal caso, esa característica concreta puede eliminarse del conjunto de datos pero sólo si esa característica es insignificante. Sin embargo, la eliminación de datos no siempre es la mejor idea.</p></li>
</ul>
<ul class="simple">
<li><p><strong>Imputación</strong>: La imputación es una opción mejor que la eliminación, especialmente si hay muchos valores atípicos en el conjunto de datos. Esto puede hacerse de tres maneras:</p>
<ul>
<li><p>La forma más común es imputar los valores atípicos con la <strong>media</strong>, la <strong>mediana</strong> o la <strong>moda</strong> de la columna. Sin embargo, en el caso de muchos valores atípicos, estos valores pueden no ser lo suficientemente bueno, ya que cada valor atípico será un problema, debido a que cada uno de estos valores será sustituido por el mismo valor (la <strong>media</strong>, la <strong>mediana</strong> o la <strong>moda</strong>)</p></li>
<li><p>El otro método para obtener mejores valores para los valores atípicos, especialmente en el caso de de <strong>series temporales</strong>, es la <strong>interpolación lineal</strong>, es decir, el uso de polinomios lineales para crear nuevos puntos de datos dentro de un rango definido de puntos conocidos para reemplazar valores atípicos.</p></li>
<li><p>Un modelo de regresión lineal también puede utilizarse para predecir un valor que falta si es numérico, y en el caso de que el valor que falta sea categórico, se puede utilizar un modelo de regresión logística.</p></li>
<li><p>Por ejemplo, supongamos que tiene un conjunto de datos del que necesita mostrar una relación entre la altura y el peso. La columna de la altura tiene varios valores perdidos pero, como es una característica significativa, no puede eliminarla, ni tampoco puede imputar la media de la columna ya que eso podría llevar a una relación falsa. El conjunto de datos puede dividirse en dos conjuntos de datos</p>
<ul>
<li><p>El conjunto de datos de entrenamiento, que contiene instancias sin valores perdidos</p></li>
<li><p>El nuevo conjunto de datos, que contiene sólo los casos en los que faltan valores en la columna de altura.</p></li>
<li><p>A continuación, se puede utilizar un modelo de regresión lineal en el conjunto de datos de entrenamiento. El modelo aprenderá de estos datos y, cuando se le proporcione el nuevo conjunto de datos, podrá predecir los valores de la columna de altura. Ahora, los dos conjuntos de datos pueden fusionarse juntos y ser utilizados para crear visualizaciones ya que no hay valores perdidos.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Transformación</strong>: Es el proceso de transformación de los valores atípicos mediante la construcción de la columna de datos en la que se encuentra el valor atípico, por ejemplo, convirtiendo los valores en porcentajes y utilizando esa columna como característica en lugar de la columna original. En la siguiente sección, veremos un ejercicio para entender cómo podemos tratar los los valores atípicos.</p></li>
</ul>
</div>
<div class="section" id="ejercicio-53-como-tratar-los-valores-atipicos">
<h2>Ejercicio 53: Cómo tratar los valores atípicos<a class="headerlink" href="#ejercicio-53-como-tratar-los-valores-atipicos" title="Permalink to this headline">¶</a></h2>
<p><strong>Detección de valores atípicos</strong></p>
<ul class="simple">
<li><p>Si nuestro conjunto de datos es pequeño, podemos detectar el valor atípico simplemente mirando el conjunto de datos. Pero si tenemos un conjunto de datos enorme, ¿cómo podemos identificar los valores atípicos? Tenemos que utilizar técnicas de visualización y matemáticas. A continuación se presentan algunas de las técnicas de detección de valores atípicos</p>
<ul>
<li><p>Boxplots</p></li>
<li><p>Puntuación <span class="math notranslate nohighlight">\(Z\)</span></p></li>
<li><p>Rango intercuantil <strong>(IQR)</strong></p></li>
</ul>
</li>
</ul>
<p><strong>Detección de valores atípicos mediante las puntuaciones <span class="math notranslate nohighlight">\(Z\)</span></strong></p>
<ul class="simple">
<li><p><strong>Criterio</strong>: Cualquier dato cuya puntuación <span class="math notranslate nohighlight">\(Z\)</span> esté fuera de la tercera desviación estándar es un valor atípico</p></li>
</ul>
<p><img alt="" src="_images/z_score.png" /></p>
<p><strong>Implementación</strong>:</p>
<ul class="simple">
<li><p>Recorrer todos los datos y calcular la puntuación <span class="math notranslate nohighlight">\(Z\)</span> mediante la fórmula <span class="math notranslate nohighlight">\((X_{i}-\mu)/\sigma\)</span>. Definir un valor de umbral de 3 y marcar los puntos de datos cuyo valor absoluto de puntuación <span class="math notranslate nohighlight">\(Z\)</span> sea mayor que el umbral como valores atípicos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">detect_outliers_zscore</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">thres</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="n">std</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z_score</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thres</span><span class="p">):</span>
            <span class="n">outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outliers</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_outliers</span> <span class="o">=</span> <span class="n">detect_outliers_zscore</span><span class="p">(</span><span class="n">gym</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Outliers from Z-scores method: &quot;</span><span class="p">,</span> <span class="n">sample_outliers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Outliers from Z-scores method:  [790]
</pre></div>
</div>
</div>
</div>
<p><strong>Detección de valores atípicos mediante el rango intercuantil (IQR)</strong></p>
<ul class="simple">
<li><p><strong>Criterio</strong>: Los datos que se sitúan 1.5 veces del <strong>IQR</strong> por encima de <span class="math notranslate nohighlight">\(Q_{3}\)</span> y por debajo de <span class="math notranslate nohighlight">\(Q_{1}\)</span> son valores atípicos.</p></li>
</ul>
<p><strong>Implementación</strong></p>
<ul class="simple">
<li><p>Ordenar el conjunto de datos de forma ascendente</p></li>
<li><p>Calcular los cuartiles 1 y 3 <span class="math notranslate nohighlight">\((Q_{1}, Q_{3})\)</span></p></li>
<li><p>Calcular <span class="math notranslate nohighlight">\(IQR=Q_{3}-Q_{1}\)</span></p></li>
<li><p>Calcular el límite inferior = <span class="math notranslate nohighlight">\((Q_{1}-1.5*IQR)\)</span>, el límite superior = <span class="math notranslate nohighlight">\((Q_{3}+1.5*IQR)\)</span>, recorrer los valores del conjunto de datos y comprobar los que están por debajo del límite inferior y por encima del límite superior y marcarlos como valores atípicos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">detect_outliers_iqr</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">q3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
    <span class="n">IQR</span> <span class="o">=</span> <span class="n">q3</span><span class="o">-</span><span class="n">q1</span>
    <span class="n">lwr_bound</span> <span class="o">=</span> <span class="n">q1</span><span class="o">-</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">IQR</span><span class="p">)</span>
    <span class="n">upr_bound</span> <span class="o">=</span> <span class="n">q3</span><span class="o">+</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">IQR</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">lwr_bound</span> <span class="ow">or</span> <span class="n">i</span><span class="o">&gt;</span><span class="n">upr_bound</span><span class="p">):</span>
            <span class="n">outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outliers</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_outliers</span> <span class="o">=</span> <span class="n">detect_outliers_iqr</span><span class="p">(</span><span class="n">gym</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Outliers from IQR method: &quot;</span><span class="p">,</span> <span class="n">sample_outliers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Outliers from IQR method:  [790]
</pre></div>
</div>
</div>
</div>
<p><strong>Tratamiento de los valores atípicos</strong></p>
<p><strong>Eliminación</strong></p>
<ul class="simple">
<li><p>En este ejercicio, vamos a eliminar la instancia que contiene el valor atípico del conjunto de datos que utilizamos en el Ejercicio 52, y visualizamos el conjunto de datos de nuevo generando un gráfico de caja basado en el nuevo conjunto de datos.</p></li>
</ul>
<ul class="simple">
<li><p>Importar las librerías necesarias</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Guarda el archivo <em>gym.csv</em> en un DataFrame llamado <strong>gym</strong>, e imprime las cinco primeras filas del mismo para ver cómo son los datos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gym</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/gym.csv&#39;</span><span class="p">)</span>
<span class="n">gym</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>88</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>45</td>
      <td>96</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35</td>
      <td>91</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>37</td>
      <td>790</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>62</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Modificar el DataFrame del gimnasio para que sólo esté formado por los casos en los que el peso sea inferior a 103 e imprimir las cinco primeras filas:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gym_del</span> <span class="o">=</span> <span class="n">gym</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">104</span><span class="p">]</span>
<span class="n">gym_del</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>88</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>45</td>
      <td>96</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35</td>
      <td>91</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>62</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>58</td>
      <td>55</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Vamos a crear un boxplot para ver el aspecto de los datos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">gym_del</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">notched</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_232_0.svg" src="_images/section2_232_0.svg" /></div>
</div>
<p><strong>Imputación por medio de la <em>media, mediana o moda</em></strong></p>
<ul class="simple">
<li><p>Como el valor medio es sensible a valores atípicos, se aconseja sustituirlos por la mediana</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">gym</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;median: &quot;</span><span class="p">,</span> <span class="n">median</span><span class="p">)</span>

<span class="k">for</span> <span class="n">outlier</span> <span class="ow">in</span> <span class="n">sample_outliers</span><span class="p">:</span>
    <span class="n">gym</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gym</span><span class="o">.</span><span class="n">weight</span> <span class="o">==</span> <span class="n">outlier</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median:  76.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gym</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>88.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>45</td>
      <td>96.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35</td>
      <td>91.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>37</td>
      <td>76.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>62.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">gym</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">notched</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_236_0.svg" src="_images/section2_236_0.svg" /></div>
</div>
</div>
<div class="section" id="ejercicio-54-tratamiento-de-los-valores-faltantes">
<h2>Ejercicio 54: Tratamiento de los valores faltantes<a class="headerlink" href="#ejercicio-54-tratamiento-de-los-valores-faltantes" title="Permalink to this headline">¶</a></h2>
<p><strong>Datos faltantes</strong></p>
<ul class="simple">
<li><p>Los datos perdidos son, como su nombre indica, valores que están en blanco (<strong>NaN, -, 0</strong> cuando no deberían ser <strong>0</strong>, etc.). Al igual que los valores atípicos, los valores perdidos pueden ser problemáticos tanto en el caso de las visualizaciones como en el de los modelos predictivos.</p></li>
<li><p>Los valores faltantes en las visualizaciones pueden mostrar una tendencia que en realidad no existe o no representa una relación entre dos variables que, en realidad, es significativa. Aunque es posible crear visualizaciones con un conjunto de datos que contenga valores perdidos, no se recomienda hacerlo. Al hacerlo, se ignoran los casos en los que se encuentran esos valores perdidos, creando así una visualización basada en algunos de los datos pero no en todos.</p></li>
<li><p>Por lo tanto, el tratamiento de los valores perdidos es de suma importancia. Existen dos enfoques principales para tratar los valores perdidos: la supresión y la imputación, ambos discutidos en términos de tratamiento de los valores atípicos. La La misma lógica se aplica a los valores perdidos.</p></li>
</ul>
<ul class="simple">
<li><p>En este ejercicio, vamos a trabajar con un conjunto de datos que tiene siete valores perdidos en forma de 0s. En primer lugar, eliminaremos las instancias que contienen estos valores perdidos y generar un gráfico de caja para ver el impacto que la eliminación de un gran número de instancias en nuestra visualización. A continuación, imputaremos el valor de la mediana de la columna que que contiene los valores perdidos y generaremos un gráfico de caja basado en este conjunto de datos imputados.</p></li>
</ul>
<ul class="simple">
<li><p>Importar las librerías necesarias</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Guarda el archivo <em>weight.csv</em> en un <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> llamado <strong>weight</strong>, e imprime las cinco primeras filas del mismo para ver cómo son los datos y utiliza la función <code class="docutils literal notranslate"><span class="pre">.describe()</span></code> para mostrar información sobre ella</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/weight.csv&#39;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>47</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>34</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>62.000000</td>
      <td>62.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>33.887097</td>
      <td>0.838710</td>
    </tr>
    <tr>
      <th>std</th>
      <td>15.683451</td>
      <td>0.813685</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>25.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>35.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>46.000000</td>
      <td>1.750000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>56.000000</td>
      <td>2.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Como podemos ver, el valor de peso mínimo en nuestro conjunto de datos es <strong>0</strong>; sin embargo, nadie puede pesar <strong>0 kgs</strong>, lo que significa que tenemos valores faltantes en forma de <strong>0s</strong>. Intentemos eliminar estas instancias.</p></li>
<li><p>Cree un nuevo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que conste sólo de las instancias en las que el peso no sea igual a <strong>0</strong>. Muestre información sobre este nuevo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc_w</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">weight</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">doc_w</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>55.00000</td>
      <td>55.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>38.20000</td>
      <td>0.836364</td>
    </tr>
    <tr>
      <th>std</th>
      <td>10.49056</td>
      <td>0.811118</td>
    </tr>
    <tr>
      <th>min</th>
      <td>21.00000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>31.00000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>36.00000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>46.50000</td>
      <td>1.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>56.00000</td>
      <td>2.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Crea un <code class="docutils literal notranslate"><span class="pre">boxplot</span></code> con este nuevo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, con el eje <span class="math notranslate nohighlight">\(x\)</span> como sexo y el eje <span class="math notranslate nohighlight">\(y\)</span> como peso</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">doc_w</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">notched</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_248_0.svg" src="_images/section2_248_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Ahora, el valor del peso mínimo es 21, lo que tiene más sentido. Sin embargo, nuestro conteo se ha reducido a 55 de 62, lo que significa que hemos eliminado 7 instancias de nuestro conjunto de datos. Esto puede parecer pequeño en este ejemplo, pero en realidad, esto puede tener repercusiones serias en la información obtenida.</p></li>
<li><p>Además, en el gráfico de caja anterior, el extremo inferior de la caja para el sexo 0 y el extremo superior de la caja para el sexo 2 es ligeramente anormal. Por lo tanto, sustituyamos los valores 0 de la columna de peso por el valor medio de la columna. Recuerde que tenemos que calcular la media de la columna <strong>¡columna sin tener en cuenta esos valores 0!</strong> Si los tenemos en cuenta, entonces nuestra media será incorrecta.</p></li>
</ul>
<ul class="simple">
<li><p>Calcular la media de la columna de pesos del <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que consiste en sólo valores de peso distintos de cero</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_w</span> <span class="o">=</span> <span class="n">doc_w</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_w</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38.2
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utilice la función <code class="docutils literal notranslate"><span class="pre">.replace()</span></code> para sustituir los valores <strong>0</strong> presentes en la columna <strong>weight</strong> del <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> original por la media de la columna <strong>weight</strong> del modificado. Guarde esto en un nuevo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_new</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">mean_w</span><span class="p">}})</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Muestra la información del nuevo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_new</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weight</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>62.000000</td>
      <td>62.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>38.200000</td>
      <td>0.838710</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.870307</td>
      <td>0.813685</td>
    </tr>
    <tr>
      <th>min</th>
      <td>21.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>31.250000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>38.100000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>46.000000</td>
      <td>1.750000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>56.000000</td>
      <td>2.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Nuestro recuento es de 62, lo que significa que tenemos todas las instancias, y nuestro peso mínimo es 21, lo que significa que no tenemos ningún <strong>0</strong>.</p></li>
<li><p>Cree un gráfico de caja con este nuevo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, con el eje <span class="math notranslate nohighlight">\(x\)</span> como <strong>sex</strong> y el eje <span class="math notranslate nohighlight">\(y\)</span> como <strong>weight</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">w_new</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">notched</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_257_0.svg" src="_images/section2_257_0.svg" /></div>
</div>
<ul class="simple">
<li><p>Ahora, tenemos una visualización que no tiene valores perdidos y representa todas las instancias que están presentes en el conjunto de datos. Veamos el tercer problema que puede generar una visualización defectuosa.</p></li>
</ul>
<p><strong>Instancias y/o funciones duplicadas</strong></p>
<ul class="simple">
<li><p>El tercer problema es la presencia de instancias y/o características duplicadas en un conjunto de datos. Se trata de elementos innecesarios en el conjunto de datos y, si no se eliminan, pueden pueden afectar a las tendencias y a los conocimientos que se muestran en una visualización.</p></li>
<li><p>Por ejemplo, puede crear una visualización que muestre la relación entre el género de un adolescente y si toca el piano. Con un conjunto de datos sin valores atípicos, anomalías o valores perdidos, obtendrá una gran visualización. A partir de la visualización, podrá también podrá concluir que hay más mujeres que tocan el piano que hombres. Sin embargo, digamos que la visualización proviene del conjunto de datos siguiente</p></li>
</ul>
<p><img alt="" src="_images/Figure714.png" /></p>
<ul class="simple">
<li><p>Hay dos instancias para <strong>Nita Thadaka</strong> y tres instancias para <strong>Pooja Rajesh</strong>, lo que significa que hay tres instancias duplicadas en total. Esto significa que la información que la visualización está proporcionando es inexacta. La forma de tratar los duplicados es sencilla: <strong>eliminarlos</strong>. Con este fin puede utlizar la función: <code class="docutils literal notranslate"><span class="pre">.drop_duplicates()</span></code></p></li>
</ul>
<p><strong>Mala selección de características</strong></p>
<ul class="simple">
<li><p>Con respecto a un conjunto de datos, una característica es una columna en el conjunto de datos, mientras que una instancia es una fila en el conjunto de datos. Por ejemplo, en la tabla anterior, nombre, sexo, tocar el piano y la edad son características, mientras que Pooja Rajesh, F, Yes y 17 es una instancia.</p></li>
<li><p>Dado que el objetivo de una visualización es mostrar una tendencia, un patrón, una relación o algún vínculo entre dos o más características en un conjunto de datos, es importante que la selección de esas características se haga con cuidado. Por lo tanto, este es un punto crucial en la visualización de datos
de datos.
Si el objetivo es transmitir que existe una fuerte relación entre dos características, entonces hay que
Si el objetivo es transmitir que existe una fuerte relación entre dos características, hay que asegurarse de que están fuertemente correlacionadas antes de proceder a su visualización.
La selección de características insignificantes dará lugar a una visualización sin sentido y no acabará
no transmitirá ninguna información concreta. Por ejemplo, en cuanto al conjunto de datos co2.csv,
el conjunto de datos contiene información sobre las emisiones de dióxido de carbono por
país y el PIB por país. Comprobamos la correlación entre las emisiones de CO2
y el PIB antes de visualizar el conjunto de datos, garantizando que íbamos a crear una
una visualización que valiera la pena.</p></li>
</ul>
</div>
<div class="section" id="tarea-2-3">
<h2>Tarea 2.3<a class="headerlink" href="#tarea-2-3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Determine las características que se visualizan en un gráfico de dispersión. Se le da el conjunto de datos co2.csv y se le pide que proporcione información sobre él, como por ejemplo, qué tipo de patrones existen, si hay tendencias entre las características, etc. Es necesario que su visualización final transmita información significativa. Para conseguirlo, va a crear visualizaciones para diferentes emparejamientos de características para entender están correlacionadas y, por lo tanto, vale la pena visualizarlas.</p></li>
</ul>
<p><strong>Pasos principales</strong></p>
<ul class="simple">
<li><p>Importe las bibliotecas necesarias.</p></li>
<li><p>Vuelva a crear el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Desde el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">gm</span></code> incluya las columnas <code class="docutils literal notranslate"><span class="pre">population</span></code>, <code class="docutils literal notranslate"><span class="pre">fertility</span></code>, y <code class="docutils literal notranslate"><span class="pre">life</span></code></p></li>
<li><p>Visualiza la relación entre el <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">life</span></code> utilizando un gráfico de dispersión, con el nombre del país como información en la herramienta hover y el año como deslizador.</p></li>
<li><p>Comprueba la correlación entre <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">life</span></code>.</p></li>
<li><p>Visualiza la relación entre <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">fertility</span></code> mediante un gráfico de dispersión, con el nombre del país como información en la herramienta hover y el año como deslizador.</p></li>
<li><p>Comprueba la correlación entre <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">fertility</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="importacion-y-cargue-de-datos-en-postgresql-usando-heroku">
<h1>Importación y cargue de datos en PostgreSQL usando Heroku<a class="headerlink" href="#importacion-y-cargue-de-datos-en-postgresql-usando-heroku" title="Permalink to this headline">¶</a></h1>
<p><strong>Objetivos</strong></p>
<ul class="simple">
<li><p>Crear un base de datos en <strong>Heroku Postgres</strong> y verificar conexión y e importación de tablas usando pgAdmin de PostgreSQL</p></li>
<li><p>Utilizar alternativas proporcionadas por el cliente de <strong>Heroku</strong> para solucionar el problema de las 20 conexiones</p></li>
<li><p>Utilizar la <strong>API</strong> de <strong>Python</strong> para <strong>PostgreSQL</strong> para importar datos desde un archivo <strong>CSV</strong> a <strong>Heroku Postgres</strong> y luego realizar consultas a nuestras tablas creadas y  estudciar la forma de realizar cálculos especificos mediante consultas <strong>SQL</strong></p></li>
<li><p>Generar visualizaciones a partir de las tablas creadas</p></li>
</ul>
<div class="section" id="id2">
<h2>Introducción<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><img alt="" src="_images/heroku1.png" /></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Heroku</span></code> es una empresa que se especializa en ofrecer servicios de plataforma administrada, por sus siglas en inglés PasS, en otras palabras ofrece servicios de servidores y redes administrados por Heroku en donde se pueden alojar aplicaciones de diferentes lenguajes de programación como Python, Java, PHP y más. Los servicios que Heroku ofrece están claramente orientados para desarrolladores, startups y empresas pequeñas. Heroku nació en el 2007 y fue adquirida en el 2010 por <a class="reference external" href="http://salesforce.com">salesforce.com</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Heroku</span></code> utiliza contenedores Linux (Ubuntu) los cuales son llamados “dynos”, estos son utilizados para alojar las aplicaciones web, webservices o aplicaciones que se ejecutan del lado del servidor, así mismo cuenta con la posibilidad de instalar add-ons para agregar funcionalidades a dichos contenedores, por ejemplo, se pueden agregar servicios administrados de base de datos, almacenamiento en la nube o mensajería(MQ) por mencionar algunos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Heroku</span></code> tiene su clientela bien definida: empresas que quieren dejar de preocuparse por cuestiones de infraestructura y sólo enfocarse en el desarrollo. Por lo general estas suelen ser empresas grandes o startups que prefieren no invertir en un equipo de operaciones cuando están en una etapa temprana, y su prioridad debe ser hacer un producto que las personas quieran.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Heroku</span></code> tiene dos tiers, o niveles, para personas interesadas en aprender: una versión gratuita similar a la de <a class="reference external" href="http://now.sh">now.sh</a>, que entra en modo “sleep” cada 30 minutos sin tráfico, y otra de 7 USD que compite con el servicio básico de 5 USD al mes que ofrece Digital Ocean, pero agregar las ventajas de que nuestros servidores sean administrados por nosotros.</p></li>
</ul>
<p><img alt="" src="_images/postgresql1.png" /></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> es un sistema para gestionar bases de datos de muy alto nivel, completamente de software libre y con una licencia BSD, compatible con cualquier uso, ya sea personal o comercial. Este sistema tiene como precursor otro sistema gestor de bases de datos, llamado INGRES, que fue uno de los primeros intentos de implementar un sistema de bases de datos relacional. INGRES abrió el camino para muchos otros sistemas conocidos como Sybase, Informix o el propio SQL Server. El impulsor de INGRES lideró posteriormente también el desarrollo de PostgreSQL, cuyo nombre del proyecto hace referencia a su propia raíz (Post-Ingres).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> es un sistema considerado como empresarial. Tratándose de la aplicación de bases de datos más avanzado de código abierto, podría utilizarse por su funcionalidad y potencia como reemplazo de otras bases de datos comerciales, incluso del poderoso Oracle. Hasta cierto punto, resulta extraño que no sea el más popular, condición que ostenta MySQL.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> tiene dos ventajas fundamentales, primero en lo que respecta a su funcionalidad y capacidad de trabajar con mayores cantidades de datos, pero también en lo que respecta a su licencia. MySQL tiene una licencia dual, lo que significa que para proyectos comerciales habría que pagar por su uso. Sin embargo, PostgreSQL tiene una única licencia totalmente abierta para cualquier uso. Algunas de sus principales características son: Alta concurrencia, Soporte para múltiples tipos de datos de manera nativa, Soporte a triggers, Trabajo con vistas, Objeto-relacional, Soporte para bases de datos distribuidas, Soporte para gran cantidad de lenguajes como <strong>C, C++, Java, PHP o Python</strong>. Además, ofrece interfaces para ODBC y JDBC, así como interfaces de programación para infinidad de lenguajes de programación.</p></li>
</ul>
</div>
<div class="section" id="creacion-de-base-de-datos-heroku-postgres">
<h2>Creación de base de datos <code class="docutils literal notranslate"><span class="pre">Heroku</span> <span class="pre">Postgres</span></code><a class="headerlink" href="#creacion-de-base-de-datos-heroku-postgres" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Antes de seguir con los siguientes pasos debe tener isntalado <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code>. El objetivo en esta sección es, luego de crear la base de datos en la nube <code class="docutils literal notranslate"><span class="pre">Heroku</span> <span class="pre">Postgres</span></code>, realizaremos conexiones a esta misma utlizando <code class="docutils literal notranslate"><span class="pre">pgAdmin</span></code> con el objetivo de verificar que ésta fue creada exitosamente. Para instalar <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> puede seguir cada uno de los siguientes tutoriales, seleccionados de los muchos que puede encontrar en la red. Si se siente a gusto con algún otro tutorial en el que realicen el mismo procedimiento, adelante. Sólo tenga en cuenta, agregar todas las componentes de <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> en el proceso de instalación</p>
<ul>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=RAFZleZYxsc&amp;ab_channel=ProgrammingKnowledge2">Windows</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=-LwI4HMR_Eg&amp;ab_channel=ProgrammingKnowledge">Ubuntu</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=EZAa0LSxPPU&amp;ab_channel=ProgrammingKnowledge2">Mac</a></p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Una vez tiene isntalado <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code>, procedemos con la creación de la base de datos en <code class="docutils literal notranslate"><span class="pre">Heroku</span></code>. <code class="docutils literal notranslate"><span class="pre">Heroku</span> <span class="pre">Postgresql</span></code> requiere de la creación de una <code class="docutils literal notranslate"><span class="pre">app</span></code> inical, para poder crear la base de datos. No es necesario aún desplegar su aplicación <code class="docutils literal notranslate"><span class="pre">Dash</span></code> o <code class="docutils literal notranslate"><span class="pre">Shiny</span></code> en <code class="docutils literal notranslate"><span class="pre">Heroku</span></code>, sólo usaremo la nube para crear nuestra base de datos y cargar nuestras tablas. Primero que todo acceda al sitio web de <a class="reference external" href="https://www.heroku.com/">Heroku</a>, haga click en la parte superior derecha <strong>Sign up</strong> y cree una cuenta</p></li>
</ul>
<p><img alt="" src="_images/heroku2.png" /></p>
<ul class="simple">
<li><p>Creada la cuenta en <code class="docutils literal notranslate"><span class="pre">Heroku</span></code> procedemos a la creación de una <code class="docutils literal notranslate"><span class="pre">app</span></code> para poder crear la base de datos. La <code class="docutils literal notranslate"><span class="pre">app</span></code> es la unidad fundamental de organización en <code class="docutils literal notranslate"><span class="pre">Heroku</span></code>. Cada <code class="docutils literal notranslate"><span class="pre">app</span></code> puede estar asociada a su propio conjunto de complementos provisionados. Hacemos click en <strong>Create new app</strong> en la pagina inicial en nuestra, al ingresar a nuesta cuenta en <code class="docutils literal notranslate"><span class="pre">Heroku</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku3.png" /></p>
<ul class="simple">
<li><p>Crea una <code class="docutils literal notranslate"><span class="pre">app</span></code> con el nombre de tu preferencia. La plataforma no acepta nombres con guión bajo, pero si al medio. Podrás crear otra luego de este primer test otra <code class="docutils literal notranslate"><span class="pre">app</span></code>, sólo trata esta primera vez de seguir cuidadosamente cada paso.</p></li>
</ul>
<p><img alt="" src="_images/heroku4.png" /></p>
<ul class="simple">
<li><p>Luego de realizar éste procedimiento visualizarás la <code class="docutils literal notranslate"><span class="pre">app</span></code> de <code class="docutils literal notranslate"><span class="pre">Heroku</span></code> en la siguiente forma. En éste lugar puedes desplegar también tu app de <code class="docutils literal notranslate"><span class="pre">Dash</span></code> o <code class="docutils literal notranslate"><span class="pre">Shiny</span></code> que estudiaremos en la siguiente sección. Esta vez, sólo utilizaremos la <code class="docutils literal notranslate"><span class="pre">app</span></code> para crear una instancia para nuestra base de datos. Haga click en <strong>Resources</strong> con este objetivo</p></li>
</ul>
<p><img alt="" src="_images/heroku5.png" /></p>
<ul class="simple">
<li><p>Luego le va a aparecer la siguiente ventana. Debe hacer click en <strong>Find more add-ons</strong>. Procedemos a instalar el <code class="docutils literal notranslate"><span class="pre">addon</span></code> para instalar la base de datos basada en <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code>. Aparecerá una lista de varios <code class="docutils literal notranslate"><span class="pre">addons</span></code> que no usaremos en este momento, seleccionaremos de la lista a <code class="docutils literal notranslate"><span class="pre">Heroku</span> <span class="pre">Postgres</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku6.png" />
<img alt="" src="_images/heroku7.png" /></p>
<ul class="simple">
<li><p>Asegurese de que está instalando la versión gratuita de <code class="docutils literal notranslate"><span class="pre">Heroku</span> <span class="pre">Postgres</span></code>. Debe aparecer el mensaje que vemos en pantalla <strong>Starting at 0/mo</strong> y más aabajo <strong>Hobby Dev Free</strong>. Nótese también que en esta página aparece la capacidad de almacenamiento, número máximo de filas que debe tener la tabla que importemos en <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> y además el número de conexiones, al cual buscaremos una solución alternativa, mas adelante. Haga click en <strong>Install Heroku Postgres</strong> y asegurese de estar logeado con tu cuenta</p></li>
</ul>
<p><img alt="" src="_images/heroku8.png" />
<img alt="" src="_images/heroku9.png" /></p>
<ul class="simple">
<li><p>Luego de realizar la instalación, le aparecerá la siguiente pantalla en la que deberá seleccionar la <code class="docutils literal notranslate"><span class="pre">app</span></code> que creamos anteriormente. Haga click en <strong>Submit Order Form</strong> para finalizar la creación de su base de datos y espere unos segundos</p></li>
</ul>
<p><img alt="" src="_images/heroku10.png" />
<img alt="" src="_images/heroku11.png" /></p>
<ul class="simple">
<li><p>Exploremos ahora la base de datos que hemos creado. Nótese que el costo estimado mensual es 0. Efectivamente esto ocurre porque hemos seleccionado la versión gratuita <strong>Hobby Dev - Free</strong>. Hagamos click en <strong>Heroku Postgres</strong> para buscar la información de conexión a nuestra nueva base de datos</p></li>
</ul>
<p><img alt="" src="_images/heroku12.png" /></p>
<ul class="simple">
<li><p>Por ahora no veremos ninguna conexión, hasta que comencemos a usar la la base de datos. Optaremos por usa <strong>pgAdmin</strong> a manera de test, con el objetivo principal de verificar que podemos realizar conexiones a nuestra base de datos <code class="docutils literal notranslate"><span class="pre">Heroku</span> <span class="pre">Postgres</span></code>.</p></li>
</ul>
<p><img alt="" src="_images/heroku13.png" /></p>
<ul class="simple">
<li><p>Haga click en <strong>Settings</strong> y <strong>View Credentials</strong> para poder acceder a la información necesaria para la conexión a la base de datos. Estos datos son los que usaremos mas adelante para conectarnos a esta base de datos con <strong>pgAdmin</strong> de <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> y también desde nuestro notebook de <code class="docutils literal notranslate"><span class="pre">Python</span></code>, utlizando la <strong>API</strong> encargada de esto. La información en el recuadro es la más importante, pues es la que usaremos para realizar nuestra conexión a nuestra base de datos</p></li>
</ul>
<p><img alt="" src="_images/heroku14.png" />
<img alt="" src="_images/heroku15.png" /></p>
<p><strong><code class="docutils literal notranslate"><span class="pre">pgAdmin</span> <span class="pre">PostgreSQL</span></code></strong></p>
<ul class="simple">
<li><p>Ahora realizaremos una prueba de conexión utilizando <strong>pgAdmin</strong>, la cual viene incluida en la instalación de <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code>. Inice la aplicación, le pedirá la contraseña que utlizó durante la instalación. Vamos a crear un servidor remoto el cual usaremos para conectarnos a la base de datos <strong>Heroku Postgres</strong>. Haga click derecho en <strong>Servers</strong> luego <strong>Create/Server</strong> como en la siguiente imágen</p></li>
</ul>
<p><img alt="" src="_images/heroku16.png" /></p>
<ul class="simple">
<li><p>Coloque el nombre de su preferencia al servidor que usaremos para conectarnos a la base de datos. Usted puede crear una base de datos desde su computadora. Su computadora funcionaría como un servidor local, a diferencia de <strong>Heroku</strong> que es un servidor en la nube. Por otro lado también puede crear <strong>Dockers</strong> para desplegar aplicaciones. Un <strong>Docker</strong> es un sistema operativo (o runtime) para contenedores. El motor de <strong>Docker</strong> se instala en cada servidor en el que desee ejecutar contenedores y proporciona un conjunto sencillo de comandos que puede utilizar para crear, iniciar o detener contenedores. <strong>Heroku</strong> usa <strong>Dockers</strong> para el funcionamiento de sus servidores. Aunque <strong>Heroku</strong> facilita mucho la creación de base de datos y el despliegue de aplicaciones, con <strong>Docker</strong> obtienes infinitamente más flexibilidad y portabilidad porque el usuario controla el contenedor subyacente en lugar de tenerlo definido por <strong>Heroku</strong>. Cual usar va a depender de sus necesidades</p></li>
</ul>
<p><img alt="" src="_images/heroku17.png" /></p>
<ul class="simple">
<li><p>Dirijase a la casilla <strong>Connection</strong> y coloque en <strong>Host name/address</strong>, el <strong>Host</strong> de <strong>Heroku Postgres</strong>. Mantenga el <strong>Port</strong> como <strong>5432</strong>. Un puerto es esa interfaz a través de la cual se pueden enviar y recibir los diferentes tipos de datos. En la casilla <strong>Maintenance database</strong> colocaremos el nombre de nuestra base de datos en <strong>Heroku</strong> que aparece como <strong>Database</strong>. En la casilla <strong>Username</strong> colocaremos el nombre de usuario en <strong>Heroku</strong> que aparece como <strong>User</strong>. Luego colocamos el <strong>Pasword</strong> llamado de la misma forma en <strong>pgAdmin</strong> y <strong>Heroku Postgres</strong>. Debe verse la casilla <strong>Connection</strong> como se ve a continuación</p></li>
</ul>
<p><img alt="" src="_images/heroku18.png" /></p>
<ul class="simple">
<li><p>Además de esto debe colocar el nombre de la base de datos creada en <strong>Heroku</strong> denotado como <strong>Database</strong> en la casilla <strong>Advanced</strong>. Esto lo hacemos para poder conectarnos a nuestra base de datos y no a una de las tantas gratuitas, creadas por otros usuarios en el servidor ofrecido por <strong>Heroku</strong>. Al final en <strong>pgAdmin</strong> haga click en <strong>Save</strong></p></li>
</ul>
<p><img alt="" src="_images/heroku19.png" /></p>
<ul class="simple">
<li><p>Luego de esto podrá ver que se ha creado el servidor en <strong>pgAdmin</strong> con el nombre indicado. Ahora estamos listos para probar conexión a la base de datos en <strong>Heroku</strong> utlizando éste nuevo servidor</p></li>
</ul>
<p><img alt="" src="_images/heroku20.png" /></p>
<ul class="simple">
<li><p>Para verificar que se ha conectado a su base de datos en <strong>Heroku Postgres</strong>, haga click en overview y vera que el número de conexiones ha cambiado</p></li>
</ul>
<p><img alt="" src="_images/heroku21.png" /></p>
<ul class="simple">
<li><p>Pasemos ahora a crear un tabla de prueba en la base de datos desde <strong>pgAdmin</strong> para confirmar conexión y además visualizar el cambio en el número de tablas desde <strong>Overview</strong>. Haga click desde <strong>pgAdmin</strong> en el servidor creado con su nombre de preferencia, en este ejemplo <strong>HerokuServer</strong>, luego haga click en <strong>Tools/Query Tool</strong> para realizar una consulta a nuestra base de datos en <strong>Heroku Postgres</strong></p></li>
</ul>
<p><img alt="" src="_images/heroku22.png" /></p>
<ul class="simple">
<li><p>Verifique que en la parte superior aparece la base de datos correcta a la que estamos conectados. Creamos luego una tabla llamada <code class="docutils literal notranslate"><span class="pre">accounts</span></code> con <code class="docutils literal notranslate"><span class="pre">user_id</span></code> y <code class="docutils literal notranslate"><span class="pre">name</span></code>, para verificar que todo funciona correctamente. Seleccione el código para crear la tabla y luego presionamos el botón de <strong>Run</strong> para ejecutar el <code class="docutils literal notranslate"><span class="pre">Query</span></code>. Debe aparecer el mensaje de consulta exitosa automáticamente. Profundizaremos en la proxima sección acerca del significado de estas consultas</p></li>
</ul>
<p><img alt="" src="_images/heroku23.png" /></p>
<ul class="simple">
<li><p>Haga click luego en <strong>Schemas/Tables</strong> y vera que fue creada la tabla <code class="docutils literal notranslate"><span class="pre">accounts</span></code> en la base de datos <strong>Heroku Postgres</strong>. Nótese que en <strong>Heroku</strong> aparecerán 2 conexiones y la tabla que fue creada automáticamente en <strong>TABLE</strong></p></li>
</ul>
<p><img alt="" src="_images/heroku24.png" />
<img alt="" src="_images/heroku25.png" /></p>
<ul class="simple">
<li><p>Realicemos ahora un nuevo registro en la tabla creada, el cual vamos a poder evidenciar en <strong>overview</strong> con el ítem <strong>ROW</strong>. Utilizaremos las consultas qeu observa en la siguiente imágen. <strong>INSERT INTO</strong> es del lenguaje <strong>SQL</strong> y es utilizada para insertar datos en la tabla creada. <strong>SELECT * FROM</strong> es utlizada para seleccionar columnas de nuestra base de datos, en éste caso usamos <code class="docutils literal notranslate"><span class="pre">*</span></code> para indicar que queremos seleccionar y a su vez visualizar los datos en la tabla. Nótese que ya aparece actualizado en <strong>Heroku Postgres</strong> el ítem <strong>ROW</strong> con el nuevo registro o fila agregada a la tabla</p></li>
</ul>
<p><img alt="" src="_images/heroku26.png" />
<img alt="" src="_images/heroku27.png" /></p>
<ul class="simple">
<li><p>Cuando regrese al inicio, o ingrese nuevamente a <strong>Heroku</strong> aparecerá en la primera venta la <code class="docutils literal notranslate"><span class="pre">app</span></code>que contiene la base de datos. Podrá aceder a ella las veces que lo desee para verificar el número de conexiones y que se hayan importado las tablas correctamente</p></li>
</ul>
<p><img alt="" src="_images/heroku28.png" />
<img alt="" src="_images/heroku29.png" /></p>
<ul class="simple">
<li><p>Habrá notado que el número de conexiones a <strong>Heroku Postgres</strong> está límitado a 20 conexiones, esto suele ser un problema cuando contamos con aplicaciones que a menudo para su correcto funcionamiento realizan múltiples consultas a la base de datos. Con el fin de resolver éste problema usted puede construr un script que elimine el número de conexiones cada hora por ejemplo. La pregunta ahora sería, ¿Como eliminar estas 20 conexiones a <strong>Heroku Postgres</strong>?. Algunos desarrolladores con éste fin, utilizan <a class="reference external" href="https://github.com/heroku/heroku-pg-extras#usage">heroku-pg-extras</a>, esta librería puede ser utilizada para reiniciar el número de conexiones a <strong>Heroku Postgres</strong>. Esto va a requerir primero instalar el cliente de <strong>Heroku</strong> <a class="reference external" href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install">Heroku CLI</a>. La instalación del cliente puede ser realizada en cualquier sistema operativo, en ésta sección a manera de ejemplo realizaremos la instalación en sistema opertativo <code class="docutils literal notranslate"><span class="pre">Windows</span></code>, y además porque cuenta con el mayo número de usuarios, un total de 1.5 billones, en comparación con los 100 millones de usuarios que usan <code class="docutils literal notranslate"><span class="pre">Mac</span></code> y 40 millones que usan <code class="docutils literal notranslate"><span class="pre">Ubuntu</span></code>. El procedimiento para el resto de sistemas operativos es bastante similar, pues todo sera ejecutado desde la línea de comandos. El link de descarga del cliente <strong>Heroku CLI</strong> lo llevara a la página de instalación, donde debe escoger el binario asociado con su sistema operativo</p></li>
</ul>
<p><img alt="" src="_images/heroku30.png" /></p>
<ul class="simple">
<li><p>Mantenga todos los check por default durante la instalación de <strong>Heroku CLI</strong>, y haga click en <strong>Install</strong></p></li>
</ul>
<p><img alt="" src="_images/heroku31.png" />
<img alt="" src="_images/heroku32.png" /></p>
<ul class="simple">
<li><p>Luego que el procedimiento de instalación ha finalizado, verificamos que la instalación fue realizada con éxito. Para esto en nuestro <strong>Command Prompt</strong> o <strong>Windows PowerShell</strong>, vamos a ejecutar la siguiente orde: <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">version</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku33.png" /></p>
<ul class="simple">
<li><p>Antes de usar el cliente debemos iniciarlo con nuestra cuenta de <strong>Heroku</strong>. Para esto utilizaremos el siguiente comando el cual nos permitirá inciar el cliente pasando antes por el inicio de sesión en nuestra cuenta de <strong>Heroku</strong></p></li>
</ul>
<p><img alt="" src="_images/heroku34.png" /></p>
<ul class="simple">
<li><p>Haga click en <strong>Log In</strong> para iniciar sesión desde el cliente de <strong>Heroku</strong>de desión</p></li>
</ul>
<p><img alt="" src="_images/heroku35.png" /></p>
<ul class="simple">
<li><p>En la ventana de comando podrá ver que ya ha iniciado sesión en el cliente de <strong>Heroku</strong>. Usando la orden <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">apps</span></code> en nuestro línea de comandos podremos visualizar las <code class="docutils literal notranslate"><span class="pre">apps</span></code> que tenemos creadas, en este caso una sola, la que hemos usado en esta sección</p></li>
</ul>
<p><img alt="" src="_images/heroku36.png" /></p>
<ul class="simple">
<li><p>Si aparece un mensaje de <strong>warning</strong> relacionado con la actualización del cliente, podemos hacer este procedimiento con la orden: <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">update</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku37.png" /></p>
<ul class="simple">
<li><p>Ahora si puede instalar el plugin que permite matar todas las conexiones. Este plugin se utiliza para obtener información sobre una instancia de Heroku Postgres, que puede ser útil al analizar los problemas de rendimiento. Esto incluye información sobre los bloqueos, el uso de los índices, los ratios de éxito de la caché del buffer y las estadísticas de vacío. Para su instalación utlice la orden: <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">plugins:install</span> <span class="pre">heroku-pg-extras</span></code>. Puede ignorar los mensajes de <strong>warning</strong>, pues estos no afectarán al funcionamiento de los <code class="docutils literal notranslate"><span class="pre">heroku-pg-extras</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku38.png" /></p>
<ul class="simple">
<li><p>Escriba <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">help</span> <span class="pre">pg</span></code> para visualizar la forma de usar <code class="docutils literal notranslate"><span class="pre">heroku-pg-extras</span></code> en el cliente de <strong>Heroku</strong></p></li>
</ul>
<p><img alt="" src="_images/heroku39.png" /></p>
<ul class="simple">
<li><p>Siguiendo las intrucciones de uso de <code class="docutils literal notranslate"><span class="pre">heroku-pg-extras</span></code> podemos visualizar información acerca de la <code class="docutils literal notranslate"><span class="pre">app</span></code> creada en <strong>Heroku</strong> con la orden: <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">pg:info</span> <span class="pre">--app</span> <span class="pre">dataviz-lrubio-postgresql-test</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku40.png" /></p>
<ul class="simple">
<li><p>Para matar todas las conexiones a <strong>Heroku</strong> y dejarlas en 0, para tener nuevamente las 20 posibles disponibles, debemos utlizar <code class="docutils literal notranslate"><span class="pre">pg:killall</span></code>. En el caso que tenga una  <code class="docutils literal notranslate"><span class="pre">app</span></code> que realice muchas consultas, calcule cada cuanto completa por ejemplo las 20, por ejemplo, cada 5 minutos, y luego cree un script que se active automaticamente cada 5 minutos el cual se encarge de ejecutar <code class="docutils literal notranslate"><span class="pre">pg:killall</span></code></p></li>
</ul>
<p><img alt="" src="_images/heroku41.png" /></p>
<ul class="simple">
<li><p>Existen distintas opciones para evitar éste tipo de procedimiento. La primera de ellas es contratar el servicio mensual de <strong>Heroku</strong>. Algunos prefieren usar directamente <strong>AWS</strong> o <strong>Google Cloud</strong>, pero estos son pagos también, necesitarás usar tu tarjeta de crédito. Las versiones “gratuitas” de <strong>AWS</strong> te permiten crear bases de datos y desplegar apps, pero costos son generados siempre, incluso cuando apagas el servicio, automáticamente se activa cada 7 días generandote costos. Otra opción es usar por ejemplo <strong>Google Cloud</strong>, la cual es de agrado para muchos desarrolladores en la nube, aunque es también paga, te ofrece 3 meses gratuitos, los cuales puedes usar a tu gusto y luego decidir si mantienes o cierras tu cuenta. Por ejemplo para graficos con mapas usando <code class="docutils literal notranslate"><span class="pre">ggmap</span></code>, en la sección de <code class="docutils literal notranslate"><span class="pre">R</span></code> usaremos este plan gratuito para acceder a mapas de <strong>Google</strong>. También esta la opción de usar <strong>Docker</strong> directamente. <code class="docutils literal notranslate"><span class="pre">Docker</span></code> es un servicio de virtualización de aplicaciones dentro de unos denominados contenedores. Esto permite que las aplicaciones se ejecuten independientemente del host que los alberga. Si eres usuario de <code class="docutils literal notranslate"><span class="pre">Windows</span></code> o <code class="docutils literal notranslate"><span class="pre">Mac</span></code> necesitarás tener instalado <code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Desktop</span></code> en tu pc o portátil y éste debe tener cierta capacidad y potencia. Por otro lado, en el caso de que seas usuario de <code class="docutils literal notranslate"><span class="pre">Windows</span></code>, deberás tener la versión <code class="docutils literal notranslate"><span class="pre">Professional</span></code> para poder instalar <code class="docutils literal notranslate"><span class="pre">Docker</span></code>. Si no es así, debe hacerlo desde <code class="docutils literal notranslate"><span class="pre">Ubuntu</span></code>.</p></li>
</ul>
</div>
<div class="section" id="consultas-desde-python-a-heroku-postgres">
<h2>Consultas desde Python a Heroku Postgres<a class="headerlink" href="#consultas-desde-python-a-heroku-postgres" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> puede ser integrado con <code class="docutils literal notranslate"><span class="pre">Python</span></code> usando el módulo <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>. <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> es un adaptador de base de datos <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> para el lenguaje de programación <code class="docutils literal notranslate"><span class="pre">Python</span></code>. <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> fue escrito con el objetivo de ser muy pequeño, rápido y estable como una roca. No necesitas instalar este módulo por separado porque se entrega, por defecto, junto con la versión <code class="docutils literal notranslate"><span class="pre">2.5.x</span></code> de <code class="docutils literal notranslate"><span class="pre">Python</span></code> en adelante. Sin embargo, si no lo tienes instalado en tu máquina, puedes usar los siguientes comandos según tu preferencia de gestor de paquetes</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">psycopg2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">anaconda</span> <span class="pre">psycopg2</span></code></p></li>
</ul>
</li>
<li><p>Para utilizar el módulo <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, primero debe crear un objeto <code class="docutils literal notranslate"><span class="pre">connection</span></code> que represente la base de datos y luego, opcionalmente, puede crear un objeto <code class="docutils literal notranslate"><span class="pre">cursor</span></code> que le ayudará a ejecutar todas las sentencias <code class="docutils literal notranslate"><span class="pre">SQL</span></code>.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">APIs</span></code> del módulo Python <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code></strong></p>
<p>Las siguientes son rutinas importantes del módulo <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, que pueden satisfacer su necesidad de trabajar con la base de datos <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> desde su programa <code class="docutils literal notranslate"><span class="pre">Python</span></code>. Si usted está buscando una aplicación más sofisticada, entonces usted puede mirar en la documentación oficial del módulo <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">psycopg2</span></code>.</p>
<ul class="simple">
<li><p>Esta API abre una conexión a la base de datos PostgreSQL. Si la base de datos se abre con éxito, devuelve un objeto de conexión</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">&quot;testdb&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">&quot;postgres&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;cohondob&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Esta rutina crea un cursor que se utilizará durante toda la programación de la base de datos con <code class="docutils literal notranslate"><span class="pre">Python</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Esta rutina ejecuta una sentencia <code class="docutils literal notranslate"><span class="pre">SQL</span></code>. La sentencia <code class="docutils literal notranslate"><span class="pre">SQL</span></code> puede ser parametrizada (es decir, marcadores de posición en lugar de literales <code class="docutils literal notranslate"><span class="pre">SQL</span></code>). El módulo <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> soporta marcadores de posición utilizando el signo <code class="docutils literal notranslate"><span class="pre">%</span></code>s. Por ejemplo: <code class="docutils literal notranslate"><span class="pre">cursor.execute(&quot;insert</span> <span class="pre">into</span> <span class="pre">people</span> <span class="pre">values</span> <span class="pre">(%s,</span> <span class="pre">%s)&quot;,</span> <span class="pre">(who,</span> <span class="pre">age))</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span> <span class="p">[,</span> <span class="n">optional</span> <span class="n">parameters</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Esta rutina ejecuta un comando SQL contra todas las secuencias de parámetros o mapeos encontrados en la secuencia sql</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">seq_of_parameters</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Este atributo de sólo lectura que devuelve el número total de filas de la base de datos que han sido modificadas, insertadas o eliminadas por la última ejecución</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Este método consigna la transacción actual. Si no se llama a este método, cualquier cosa que se haya hecho desde la última llamada a <code class="docutils literal notranslate"><span class="pre">commit()</span></code> no es visible desde otras conexiones de la base de datos</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Este método revierte cualquier cambio en la base de datos desde la última llamada a <code class="docutils literal notranslate"><span class="pre">commit()</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Este método cierra la conexión a la base de datos. Tenga en cuenta que esto no llama automáticamente a <code class="docutils literal notranslate"><span class="pre">commit()</span></code>. Si simplemente cierra la conexión a la base de datos sin llamar primero a <code class="docutils literal notranslate"><span class="pre">commit()</span></code>, ¡los cambios se perderán!</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Este método obtiene la siguiente fila de un conjunto de resultados de consulta, devolviendo una única secuencia, o None cuando no hay más datos disponibles</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Esta rutina obtiene el siguiente conjunto de filas de un resultado de consulta, devolviendo una lista. Se devuelve una lista vacía cuando no hay más filas disponibles. El método intenta obtener tantas filas como indique el parámetro de tamaño.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">([</span><span class="n">size</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">arraysize</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Esta rutina recupera todas las filas (restantes) de un resultado de consulta, devolviendo una lista. Se devuelve una lista vacía cuando no hay filas disponibles.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="_images/python_postgresql_api.png" /></p>
<p><strong>Conexión a la base de datos</strong></p>
<ul class="simple">
<li><p>El siguiente código de <code class="docutils literal notranslate"><span class="pre">Python</span></code> muestra cómo conectarse a una base de datos existente. Para conectar la base de datos <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> y realizar consultas <code class="docutils literal notranslate"><span class="pre">SQL</span></code>, debes conocer el nombre de la base de datos a la que te quieres conectar. EN éste caso la información de la base de datos creada la encontramos en <strong>Heroku Postgres</strong>. Importamos primero las librerías necesarias para usar <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">psycopg2</span> <span class="kn">import</span> <span class="n">Error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                                  <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                                  <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                                  <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                                  <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL server information&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">get_dsn_parameters</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT version();&quot;</span><span class="p">)</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are connected to - &quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while connecting to PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">connection</span><span class="p">):</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PostgreSQL server information
{&#39;user&#39;: &#39;xoihbshcjgwwtd&#39;, &#39;dbname&#39;: &#39;d4oenn2g04nlqm&#39;, &#39;host&#39;: &#39;ec2-34-205-14-168.compute-1.amazonaws.com&#39;, &#39;port&#39;: &#39;5432&#39;, &#39;tty&#39;: &#39;&#39;, &#39;options&#39;: &#39;&#39;, &#39;sslmode&#39;: &#39;prefer&#39;, &#39;sslcompression&#39;: &#39;0&#39;, &#39;krbsrvname&#39;: &#39;postgres&#39;, &#39;target_session_attrs&#39;: &#39;any&#39;} 

You are connected to -  (&#39;PostgreSQL 13.4 (Ubuntu 13.4-4.pgdg20.04+1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0, 64-bit&#39;,) 

PostgreSQL connection is closed
</pre></div>
</div>
</div>
</div>
<p><strong>Crear una tabla</strong></p>
<ul class="simple">
<li><p>El siguiente programa de Python se utilizará para crear una tabla en la base de datos previamente creada</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                              <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                              <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                              <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                              <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;DROP TABLE IF EXISTS company&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE company(</span>
<span class="s1">id SERIAL PRIMARY KEY NOT NULL,</span>
<span class="s1">name TEXT NOT NULL,</span>
<span class="s1">age INT NOT NULL,</span>
<span class="s1">address CHAR(50),</span>
<span class="s1">salary REAL);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Table created successfully&quot;</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Table created successfully
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Nótese en <code class="docutils literal notranslate"><span class="pre">pgAdmin</span></code> que la tabla fué creada exitosamente. También puede visualizar los cambios ocurridos en <strong>Heroku Postgres</strong>. Para visualizar la tabla en <code class="docutils literal notranslate"><span class="pre">pgAdmin</span></code> debe hacer click en el nombre de la tabla, luego en el boton con simbolo de tabla que aparece en la parte superiro izquierda.</p></li>
</ul>
<p><img alt="" src="_images/heroku42.png" />
<img alt="" src="_images/heroku43.png" /></p>
<p><strong>Operación INSERT</strong></p>
<ul class="simple">
<li><p>El siguiente programa de <code class="docutils literal notranslate"><span class="pre">Python</span></code> muestra cómo podemos crear registros en nuestra tabla <code class="docutils literal notranslate"><span class="pre">company</span></code> creada en el ejemplo anterior</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                              <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                              <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                              <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                              <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO company (name, age, address, salary) VALUES (&#39;Paul&#39;, 32, &#39;California&#39;, 20000.00 )&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO company (name, age, address, salary) VALUES (&#39;Allen&#39;, 25, &#39;Texas&#39;, 15000.00 )&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO company (name, age, address, salary) VALUES (&#39;Teddy&#39;, 23, &#39;Norway&#39;, 20000.00 )&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO company (name, age, address, salary) </span><span class="se">\</span>
<span class="s2">                VALUES (&#39;Mark&#39;, 25, &#39;Rich-Mond &#39;, 65000.00 )&quot;</span><span class="p">);</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Records created successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Records created successfully
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Observe desde <code class="docutils literal notranslate"><span class="pre">pgAdmin</span></code> que los registros han sido actualizados efectivamente, con los valores insertados en la tabla creada</p></li>
</ul>
<p><img alt="" src="_images/heroku44.png" /></p>
<p><strong>Operación SELECT</strong></p>
<ul class="simple">
<li><p>El siguiente programa de <code class="docutils literal notranslate"><span class="pre">Python</span></code> muestra cómo podemos obtener y mostrar registros de nuestra tabla <code class="docutils literal notranslate"><span class="pre">company</span></code> creada en el ejemplo anterior</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                              <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                              <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                              <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                              <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id, name, address, salary from company&quot;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;id = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;name = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;address = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;salary = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Operation done successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id =  1
name =  Paul
address =  California                                        
salary =  20000.0 

id =  2
name =  Allen
address =  Texas                                             
salary =  15000.0 

id =  3
name =  Teddy
address =  Norway                                            
salary =  20000.0 

id =  4
name =  Mark
address =  Rich-Mond                                         
salary =  65000.0 

Operation done successfully
</pre></div>
</div>
</div>
</div>
<p><strong>Operación UPDATE</strong></p>
<ul class="simple">
<li><p>El siguiente código de <code class="docutils literal notranslate"><span class="pre">Python</span></code> muestra cómo podemos utilizar la sentencia <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> para actualizar cualquier registro y luego obtener y mostrar los registros actualizados de nuestra tabla <code class="docutils literal notranslate"><span class="pre">company</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                              <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                              <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                              <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                              <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE company set salary = 25000.00 where id = 1&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of rows updated :&quot;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id, name, address, salary from company&quot;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;id = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;name = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;address = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;salary = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Operation done successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total number of rows updated : 1
id =  2
name =  Allen
address =  Texas                                             
salary =  15000.0 

id =  3
name =  Teddy
address =  Norway                                            
salary =  20000.0 

id =  4
name =  Mark
address =  Rich-Mond                                         
salary =  65000.0 

id =  1
name =  Paul
address =  California                                        
salary =  25000.0 

Operation done successfully
</pre></div>
</div>
</div>
</div>
<p><strong>Operación DELETE</strong></p>
<ul class="simple">
<li><p>El siguiente código de <code class="docutils literal notranslate"><span class="pre">Python</span></code> muestra cómo podemos utilizar la sentencia <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> para eliminar cualquier registro y luego obtener y mostrar los registros restantes de nuestra tabla <code class="docutils literal notranslate"><span class="pre">company</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                              <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                              <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                              <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                              <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE from company where id = 2;&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of rows deleted :&quot;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id, name, address, salary from company&quot;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;id = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;name = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;address = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;salary = &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Operation done successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total number of rows deleted : 1
id =  3
name =  Teddy
address =  Norway                                            
salary =  20000.0 

id =  4
name =  Mark
address =  Rich-Mond                                         
salary =  65000.0 

id =  1
name =  Paul
address =  California                                        
salary =  25000.0 

Operation done successfully
</pre></div>
</div>
</div>
</div>
<p><strong>Importar un archivo <code class="docutils literal notranslate"><span class="pre">CSV</span></code> o un <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> en PostgreSQL</strong></p>
<ul class="simple">
<li><p>En éste ejemplo vamos a importar un archivo <code class="docutils literal notranslate"><span class="pre">CSV</span></code> en <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> utilizando la función <code class="docutils literal notranslate"><span class="pre">to_sql()</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code>. El <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> a usar corresponde al precio de <code class="docutils literal notranslate"><span class="pre">Ethereum</span></code> en <code class="docutils literal notranslate"><span class="pre">USD</span></code>. Vamos a importar el archivo en una tabla en nuestra base de datos y luego vamos a utilizar esta tabla para realizar un gráfico de <code class="docutils literal notranslate"><span class="pre">candlesticks</span></code>. Si desea ver los distinto tipos de variables numéricas y formatos de fechas en <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> ver el siguiente par de links: <a class="reference external" href="https://www.postgresql.org/docs/9.5/datatype-numeric.html">Formatos numéricos</a>, <a class="reference external" href="https://www.postgresql.org/docs/9.1/datatype-datetime.html">Formatos fechas</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ETH</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/ETH-USD.csv&quot;</span><span class="p">)</span>
<span class="n">df_ETH</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-08-07</td>
      <td>2.831620</td>
      <td>3.536610</td>
      <td>2.521120</td>
      <td>2.772120</td>
      <td>2.772120</td>
      <td>164329.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-08-08</td>
      <td>2.793760</td>
      <td>2.798810</td>
      <td>0.714725</td>
      <td>0.753325</td>
      <td>0.753325</td>
      <td>674188.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-08-09</td>
      <td>0.706136</td>
      <td>0.879810</td>
      <td>0.629191</td>
      <td>0.701897</td>
      <td>0.701897</td>
      <td>532170.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-08-10</td>
      <td>0.713989</td>
      <td>0.729854</td>
      <td>0.636546</td>
      <td>0.708448</td>
      <td>0.708448</td>
      <td>405283.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-08-11</td>
      <td>0.708087</td>
      <td>1.131410</td>
      <td>0.663235</td>
      <td>1.067860</td>
      <td>1.067860</td>
      <td>1463100.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ETH</span> <span class="o">=</span> <span class="n">df_ETH</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Open&#39;</span><span class="p">:</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;High&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Low&#39;</span><span class="p">:</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Close&#39;</span><span class="p">:</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Adj Close&#39;</span><span class="p">:</span> <span class="s1">&#39;adj_close&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Volume&#39;</span><span class="p">:</span> <span class="s1">&#39;volume&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_ETH</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>adj_close</th>
      <th>volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-08-07</td>
      <td>2.831620</td>
      <td>3.536610</td>
      <td>2.521120</td>
      <td>2.772120</td>
      <td>2.772120</td>
      <td>164329.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-08-08</td>
      <td>2.793760</td>
      <td>2.798810</td>
      <td>0.714725</td>
      <td>0.753325</td>
      <td>0.753325</td>
      <td>674188.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-08-09</td>
      <td>0.706136</td>
      <td>0.879810</td>
      <td>0.629191</td>
      <td>0.701897</td>
      <td>0.701897</td>
      <td>532170.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-08-10</td>
      <td>0.713989</td>
      <td>0.729854</td>
      <td>0.636546</td>
      <td>0.708448</td>
      <td>0.708448</td>
      <td>405283.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-08-11</td>
      <td>0.708087</td>
      <td>1.131410</td>
      <td>0.663235</td>
      <td>1.067860</td>
      <td>1.067860</td>
      <td>1463100.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://xoihbshcjgwwtd:aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9@ec2-34-205-14-168.compute-1.amazonaws.com:5432/d4oenn2g04nlqm&#39;</span><span class="p">)</span>
<span class="n">df_ETH</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;ethereum&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;xoihbshcjgwwtd&quot;</span><span class="p">,</span>
                              <span class="n">password</span><span class="o">=</span><span class="s2">&quot;aac4c765bf11a3982c859f19dcd57848c55b6e7b713fb98ca05e3711f2b9d7e9&quot;</span><span class="p">,</span>
                              <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-34-205-14-168.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                              <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                              <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d4oenn2g04nlqm&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * from ethereum;&quot;</span><span class="p">)</span>
<span class="n">close</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">ETH_sql</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">close</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">ETH_sql</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT column_name FROM information_schema.columns WHERE table_name=&#39;ethereum&#39;;&quot;</span><span class="p">)</span>
<span class="n">ETH_names</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">ETH_names</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Operation done successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-08-07</td>
      <td>2.831620</td>
      <td>3.536610</td>
      <td>2.521120</td>
      <td>2.772120</td>
      <td>2.772120</td>
      <td>164329.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-08-08</td>
      <td>2.793760</td>
      <td>2.798810</td>
      <td>0.714725</td>
      <td>0.753325</td>
      <td>0.753325</td>
      <td>674188.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-08-09</td>
      <td>0.706136</td>
      <td>0.879810</td>
      <td>0.629191</td>
      <td>0.701897</td>
      <td>0.701897</td>
      <td>532170.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-08-10</td>
      <td>0.713989</td>
      <td>0.729854</td>
      <td>0.636546</td>
      <td>0.708448</td>
      <td>0.708448</td>
      <td>405283.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-08-11</td>
      <td>0.708087</td>
      <td>1.131410</td>
      <td>0.663235</td>
      <td>1.067860</td>
      <td>1.067860</td>
      <td>1463100.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;date&#39;,),
 (&#39;open&#39;,),
 (&#39;high&#39;,),
 (&#39;low&#39;,),
 (&#39;close&#39;,),
 (&#39;adj_close&#39;,),
 (&#39;volume&#39;,)]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Operation done successfully
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ETH_names</span><span class="p">]</span>
<span class="n">ETH_sql</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">names_list</span> 
<span class="n">ETH_sql</span> <span class="o">=</span> <span class="n">ETH_sql</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span><span class="p">)</span>
<span class="n">ETH_sql</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>adj_close</th>
      <th>volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-08-07</td>
      <td>2.831620</td>
      <td>3.536610</td>
      <td>2.521120</td>
      <td>2.772120</td>
      <td>2.772120</td>
      <td>164329.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-08-08</td>
      <td>2.793760</td>
      <td>2.798810</td>
      <td>0.714725</td>
      <td>0.753325</td>
      <td>0.753325</td>
      <td>674188.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-08-09</td>
      <td>0.706136</td>
      <td>0.879810</td>
      <td>0.629191</td>
      <td>0.701897</td>
      <td>0.701897</td>
      <td>532170.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-08-10</td>
      <td>0.713989</td>
      <td>0.729854</td>
      <td>0.636546</td>
      <td>0.708448</td>
      <td>0.708448</td>
      <td>405283.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-08-11</td>
      <td>0.708087</td>
      <td>1.131410</td>
      <td>0.663235</td>
      <td>1.067860</td>
      <td>1.067860</td>
      <td>1463100.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Candlestick</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">ETH_sql</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                     <span class="nb">open</span> <span class="o">=</span> <span class="n">ETH_sql</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> 
                                     <span class="n">high</span> <span class="o">=</span> <span class="n">ETH_sql</span><span class="o">.</span><span class="n">high</span><span class="p">,</span>
                                     <span class="n">low</span> <span class="o">=</span> <span class="n">ETH_sql</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> 
                                     <span class="n">close</span> <span class="o">=</span> <span class="n">ETH_sql</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                     <span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Ethereum USD (ETH-USD)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;ETH-USD&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RebeccaPurple&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/section2_329_0.svg" src="_images/section2_329_0.svg" /></div>
</div>
</div>
<div class="section" id="id3">
<h2>Tarea 2.3<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>La primera tarea es poner a funcionar todo lo realziado en esta sección y entenderlo. Luego de esto creará una nueva tabla que llamaremos <code class="docutils literal notranslate"><span class="pre">links</span></code>, la cual contendrá información acerca de link de páginas web. La tabla debe ser creada siguiendo las siguientes instrucciones. En la siguiente revisaremos con detalle el significado de cada consulta <code class="docutils literal notranslate"><span class="pre">SQL</span></code></p></li>
</ul>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">links</span> <span class="p">(</span>
	<span class="n">id</span> <span class="kt">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">url</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
	<span class="k">name</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
	<span class="k">description</span> <span class="kt">VARCHAR</span> <span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">last_update</span> <span class="kt">DATE</span>
<span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Luego insertará datos a la tabla usando las siguientes ordenes. En cada caso mostrar debe mostrar el output generado por <strong>pgAdmin</strong>, así como también la actualización de <strong>Heroku Postgres</strong></p></li>
</ul>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;https://www.postgresqltutorial.com&#39;</span><span class="p">,</span><span class="s1">&#39;PostgreSQL Tutorial&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;http://www.oreilly.com&#39;</span><span class="p">,</span><span class="s1">&#39;O</span><span class="se">&#39;&#39;</span><span class="s1">Reilly Media&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;http://www.oreilly.com&#39;</span><span class="p">,</span><span class="s1">&#39;O</span><span class="se">&#39;&#39;</span><span class="s1">Reilly Media&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">,</span> <span class="n">last_update</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;https://www.google.com&#39;</span><span class="p">,</span><span class="s1">&#39;Google&#39;</span><span class="p">,</span><span class="s1">&#39;2013-06-01&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;http://www.postgresql.org&#39;</span><span class="p">,</span><span class="s1">&#39;PostgreSQL&#39;</span><span class="p">)</span> 
<span class="k">RETURNING</span> <span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Importe los datos del precio de <strong>Cardano USD (ADA-USD)</strong> en su base de datos <strong>Herokus Postgres</strong>, teniendo en cuenta lo explicado. Luego dibuje un gráfico de candlestick para la criptomoneda. En el siguiente link encontrará el <strong>CSV</strong> de <strong>Cardano</strong>: <a class="reference external" href="https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/ADA-USD.csv">Cardano USD (ADA-USD)</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="section1.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Introducción a la visualización de datos con Python</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Lihki Rubio<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>